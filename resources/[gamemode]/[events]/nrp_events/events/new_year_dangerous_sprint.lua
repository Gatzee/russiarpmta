local event_id = "new_year_dangerous_sprint"

local CONST_TEXT_TO_START = {
	"Уворачивайся",
	"Толкай",
	"Побеждай",
}
local CONST_TIME_IN_MS_TO_TEXT_START = 1500
local CONST_TIME_TO_START_EVENT = 3
local CONST_TIME_TO_EVENT_END = 5 * 60
local CONST_TIME_HIT_POINT = 40

local CONST_VEHICLE_MODEL = 480
local CONST_MARKER_STEP = 2
local CONST_MAP_OBJECTS = {
	642, 643,
}

local CONST_MAP_OBJECT_POSITIONS = {

	-- извилистые
	{ x = -726.395, y = -1056.956, z = 1.1, rz = 90, model = 642 },
	{ x = -740.29504394531, y = -1035.9064941406, z = 1.1000000238419, rz = 156.99993896484, model = 642 },
	{ x = -767.09503173828, y = -1011.3563842773, z = 1.1000000238419, rz = 117.99993896484, model = 642 },
	{ x = -764.14501953125, y = -980.65625, z = 1.1000000238419, rz = 50.999938964844, model = 642 },
	{ x = -733.09515380859, y = -962.70629882813, z = 1.1000000238419, rz = 8.9999389648438, model = 642 },
	{ x = -719.94506835938, y = -947.05639648438, z = 1.1000000238419, rz = 90.999969482422, model = 642 },
	{ x = -702.54516601563, y = -926.25628662109, z = 1.1000000238419, rz = 8.9999694824219, model = 642 },
	{ x = -664.29522705078, y = -928.60626220703, z = 1.1000000238419, rz = 344, model = 642 },
	{ x = -634.54522705078, y = -923.90631103516, z = 1.1000000238419, rz = 34.000030517578, model = 642 },
	{ x = -609.34539794922, y = -897.80651855469, z = 1.1000000238419, rz = 58.000030517578, model = 642 },
	{ x = -603.19543457031, y = -866.20660400391, z = 1.1000000238419, rz = 100, model = 642 },
	{ x = -620.14544677734, y = -850.10656738281, z = 1.1000000238419, rz = 173, model = 642 },
	{ x = -655.59564208984, y = -854.15643310547, z = 1.1000000238419, rz = 200, model = 642 },
	{ x = -685.04565429688, y = -846.55645751953, z = 1.1000000238419, rz = 131, model = 642 },
	{ x = -700.14562988281, y = -812.65637207031, z = 1.1000000238419, rz = 97, model = 642 },
	{ x = -687.64569091797, y = -782.50634765625, z = 1.1000000238419, rz = 38.000061035156, model = 642 },
	{ x = -653.69580078125, y = -773.40631103516, z = 1.1000000238419, rz = 352.00006103516, model = 642 },
	{ x = -615.84576416016, y = -773.40631103516, z = 1.1000000238419, rz = 8.0000610351563, model = 642 },
	{ x = -579.74578857422, y = -780.10632324219, z = 1.1000000238419, rz = 331.00006103516, model = 642 },

	-- прыжки
	{ x = -563.59558105469, y = -776.25494384766, z = 1.1000000089407, rz = 90.000183105469, model = 642 },
	{ x = -563.59558105469, y = -718.85504150391, z = 1.1000000089407, rz = 90.000183105469, model = 642 },
	{ x = -563.59558105469, y = -678.45492553711, z = 1.1000000238419, rz = 90.000183105469, model = 642 },
	{ x = -548.84552001953, y = -647.50479125977, z = 1.1000000238419, rz = 39.000183105469, model = 642 },
	{ x = -514.39562988281, y = -633.60491943359, z = 1.1000000238419, rz = 5.0001831054688, model = 642 },
	{ x = -488.99536132813, y = -618.4049987793, z = 1.1000000238419, rz = 57.000122070313, model = 642 },
	{ x = -488.79522705078, y = -592.55490112305, z = 1.1000000238419, rz = 122.00009155273, model = 642 },
	{ x = -514.24517822266, y = -575.35482788086, z = 1.1000000238419, rz = 170.00006103516, model = 642 },
	{ x = -546.14501953125, y = -581.25469970703, z = 1.1000000238419, rz = 211, model = 642 },
	{ x = -580.74517822266, y = -602.05474853516, z = 1.1000000238419, rz = 211, model = 642 },
	{ x = -613.69512939453, y = -601.35491943359, z = 1.1000000238419, rz = 120.99993896484, model = 642 },
	{ x = -612.89483642578, y = -568.40612792969, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -578.29486083984, y = -547.60607910156, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -543.69482421875, y = -526.80603027344, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -487.49481201172, y = -493.05612182617, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -452.89477539063, y = -472.25616455078, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -399.09481811523, y = -440.05618286133, z = 1.1000000238419, rz = 30.999938964844, model = 642 },

	-- извилистые
	{ x = -385.395, y = -415.956, z = 1.1, rz = 90, model = 642 },
	{ x = -399.29504394531, y = -394.9064941406, z = 1.1000000238419, rz = 156.99993896484, model = 642 },
	{ x = -426.09503173828, y = -370.3563842773, z = 1.1000000238419, rz = 117.99993896484, model = 642 },
	{ x = -423.14501953125, y = -339.65625, z = 1.1000000238419, rz = 50.999938964844, model = 642 },
	{ x = -392.09515380859, y = -321.70629882813, z = 1.1000000238419, rz = 8.9999389648438, model = 642 },
	{ x = -378.94506835938, y = -306.05639648438, z = 1.1000000238419, rz = 90.999969482422, model = 642 },
	{ x = -361.54516601563, y = -285.25628662109, z = 1.1000000238419, rz = 8.9999694824219, model = 642 },
	{ x = -323.29522705078, y = -287.60626220703, z = 1.1000000238419, rz = 344, model = 642 },
	{ x = -293.54522705078, y = -282.90631103516, z = 1.1000000238419, rz = 34.000030517578, model = 642 },
	{ x = -268.34539794922, y = -256.80651855469, z = 1.1000000238419, rz = 58.000030517578, model = 642 },
	{ x = -262.19543457031, y = -225.20660400391, z = 1.1000000238419, rz = 100, model = 642 },
	{ x = -279.14544677734, y = -209.10656738281, z = 1.1000000238419, rz = 173, model = 642 },
	{ x = -314.59564208984, y = -213.15643310547, z = 1.1000000238419, rz = 200, model = 642 },
	{ x = -344.04565429688, y = -205.55645751953, z = 1.1000000238419, rz = 131, model = 642 },
	{ x = -359.14562988281, y = -171.65637207031, z = 1.1000000238419, rz = 97, model = 642 },
	{ x = -346.64569091797, y = -141.50634765625, z = 1.1000000238419, rz = 38.000061035156, model = 642 },
	{ x = -312.69580078125, y = -132.40631103516, z = 1.1000000238419, rz = 352.00006103516, model = 642 },
	{ x = -274.84576416016, y = -132.40631103516, z = 1.1000000238419, rz = 8.0000610351563, model = 642 },
	{ x = -238.74578857422, y = -139.10632324219, z = 1.1000000238419, rz = 331.00006103516, model = 642 },

	--
	{ x = -218.39581298828, y = -135.00631713867, z = 1.1000000238419, rz = 52.000091552734, model = 642 },
	{ x = -216.59585571289, y = -110.10635375977, z = 1.1000000238419, rz = 120.00012207031, model = 642 },
	{ x = -219.29588317871, y = -76.006332397461, z = 1.1000000238419, rz = 69.000122070313, model = 642 },
	{ x = -195.04582214355, y = -50.406345367432, z = 1.1000000238419, rz = 24.000122070313, model = 642 },
	{ x = -184.49578857422, y = -30.606351852417, z = 1.1000000238419, rz = 100.00012207031, model = 642 },
	{ x = -201.54582214355, y = -14.1563539505, z = 1.1000000238419, rz = 172.00012207031, model = 642 },
	{ x = -226.74580383301, y = 5.8436460494995, z = 1.1000000238419, rz = 111.00012207031, model = 642 },
	{ x = -246.09579467773, y = 17.743642807007, z = 1.1000000238419, rz = 186.00012207031, model = 642 },
	{ x = -273.345703125, y = 2.6436426639557, z = 1.1000000238419, rz = 232.00012207031, model = 642 },
	{ x = -280.49572753906, y = -26.956348419189, z = 1.1000000238419, rz = 281.00012207031, model = 642 },
	{ x = -292.79577636719, y = -54.506351470947, z = 1.1000000238419, rz = 211, model = 642 },
	{ x = -338.99578857422, y = -82.306358337402, z = 1.1000000238419, rz = 211, model = 642 },
	{ x = -373.59582519531, y = -103.10636901855, z = 1.1000000238419, rz = 211, model = 642 },
	{ x = -393.44583129883, y = -128.50636291504, z = 1.1000000238419, rz = 252.99993896484, model = 642 },
	{ x = -417.29586791992, y = -149.25636291504, z = 1.1000000238419, rz = 189, model = 642 },
	{ x = -433.29583740234, y = -165.85632324219, z = 1.1000000238419, rz = 263, model = 642 },
	{ x = -421.84582519531, y = -186.15635681152, z = 1.1000000238419, rz = 336.00012207031, model = 642 },
	{ x = -404.89590454102, y = -212.25633239746, z = 1.1000000238419, rz = 270.00012207031, model = 642 },
	{ x = -421.84588623047, y = -238.35632324219, z = 1.1000000238419, rz = 204.00012207031, model = 642 },
	{ x = -452.5458984375, y = -259.0563659668, z = 1.1000000238419, rz = 224.00012207031, model = 642 },
	{ x = -462.34573364258, y = -286.70639038086, z = 1.1000000238419, rz = 277.00012207031, model = 642 },
	{ x = -474.24578857422, y = -317.75637817383, z = 1.1000000238419, rz = 221.00012207031, model = 642 },
	{ x = -508.09585571289, y = -333.90649414063, z = 1.1000000238419, rz = 190.00012207031, model = 642 },
	{ x = -541.09558105469, y = -347.90640258789, z = 1.1000000238419, rz = 216.00012207031, model = 642 },
	{ x = -576.04559326172, y = -364.95642089844, z = 1.1000000238419, rz = 196.00012207031, model = 642 },

	-- прыжки
	{ x = -602.29558105469, y = -352.75494384766, z = 1.1000000089407, rz = 90.000183105469, model = 642 },
	{ x = -602.29558105469, y = -295.35504150391, z = 1.1000000089407, rz = 90.000183105469, model = 642 },
	{ x = -602.29558105469, y = -254.95492553711, z = 1.1000000238419, rz = 90.000183105469, model = 642 },
	{ x = -587.54552001953, y = -224.00479125977, z = 1.1000000238419, rz = 39.000183105469, model = 642 },
	{ x = -553.09562988281, y = -210.10491943359, z = 1.1000000238419, rz = 5.0001831054688, model = 642 },
	{ x = -527.69536132813, y = -194.9049987793, z = 1.1000000238419, rz = 57.000122070313, model = 642 },
	{ x = -527.49522705078, y = -169.05490112305, z = 1.1000000238419, rz = 122.00009155273, model = 642 },
	{ x = -552.94517822266, y = -151.85482788086, z = 1.1000000238419, rz = 170.00006103516, model = 642 },
	{ x = -584.84501953125, y = -157.75469970703, z = 1.1000000238419, rz = 211, model = 642 },
	{ x = -619.44517822266, y = -178.55474853516, z = 1.1000000238419, rz = 211, model = 642 },
	{ x = -652.39512939453, y = -177.85491943359, z = 1.1000000238419, rz = 120.99993896484, model = 642 },
	{ x = -651.59483642578, y = -144.90612792969, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -616.99486083984, y = -124.10607910156, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -582.39482421875, y = -103.30603027344, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -526.19481201172, y = -69.55612182617, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -491.59477539063, y = -48.75616455078, z = 1.1000000238419, rz = 30.999938964844, model = 642 },

	--
	{ x = -443.79476928711, y = -20.156164169312, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -418.79489135742, y = 4.8438353538513, z = 1.1000000238419, rz = 58.999938964844, model = 642 },
	{ x = -422.04476928711, y = 25.69383430481, z = 1.1000000238419, rz = 139, model = 642 },
	{ x = -451.84469604492, y = 35.6438331604, z = 1.1000000238419, rz = 184, model = 642 },
	{ x = -479.24432373047, y = 21.443843841553, z = 1.1000000238419, rz = 231, model = 642 },
	{ x = -509.49420166016, y = -1.406156539917, z = 1.1000000238419, rz = 203, model = 642 },
	{ x = -542.49377441406, y = 1.4938433170319, z = 1.1000000238419, rz = 147, model = 642 },
	{ x = -564.94354248047, y = 30.243829727173, z = 1.1000000238419, rz = 109, model = 642 },
	{ x = -585.54351806641, y = 55.24382019043, z = 1.1000000238419, rz = 150, model = 642 },
	{ x = -617.84332275391, y = 61.243808746338, z = 1.1000000238419, rz = 189, model = 642 },
	{ x = -636.44311523438, y = 44.243812561035, z = 1.1000000238419, rz = 256, model = 642 },
	{ x = -656.39318847656, y = 13.593811988831, z = 1.1000000238419, rz = 218, model = 642 },
	{ x = -687.14318847656, y = 11.1938123703, z = 1.1000000238419, rz = 151.00006103516, model = 642 },
	{ x = -717.69329833984, y = 13.843811988831, z = 1.1000000238419, rz = 199.00012207031, model = 642 },
	{ x = -752.54321289063, y = 16.593807220459, z = 1.1000000238419, rz = 152.00012207031, model = 642 },
	{ x = -805.94317626953, y = 45.19380569458, z = 1.1000000238419, rz = 152.00012207031, model = 642 },
	{ x = -837.44311523438, y = 68.493782043457, z = 1.1000000238419, rz = 135.00012207031, model = 642 },
	{ x = -881.94311523438, y = 112.79377746582, z = 1.1000000238419, rz = 135.00012207031, model = 642 },
	{ x = -910.49322509766, y = 141.34373474121, z = 1.1000000238419, rz = 135.00012207031, model = 642 },
	{ x = -952.89312744141, y = 182.94375610352, z = 1.1000000238419, rz = 135.00012207031, model = 642 },
	{ x = -972.04290771484, y = 215.44374084473, z = 1.1000000238419, rz = 106.00012207031, model = 642 },
	{ x = -991.74285888672, y = 238.94372558594, z = 1.1000000238419, rz = 154.00012207031, model = 642 },
	{ x = -1012.0428466797, y = 265.89398193359, z = 1.1000000238419, rz = 100.00012207031, model = 642 },
	{ x = -1019.0427246094, y = 305.6940612793, z = 1.1000000238419, rz = 100.00012207031, model = 642 },
	{ x = -1035.0430908203, y = 318.89385986328, z = 1.1000000238419, rz = 181.00012207031, model = 642 },
	{ x = -1047.9432373047, y = 336.29391479492, z = 1.1000000238419, rz = 271.00024414063, model = 642, rz_fix = 180 },
	{ x = -1048.6434326172, y = 376.69396972656, z = 1.1000000238419, rz = 271.00024414063, model = 642 },
	{ x = -1066.4927978516, y = 388.94393920898, z = 1.1000000238419, rz = 181.00012207031, model = 642 },
	{ x = -1106.8939208984, y = 388.24383544922, z = 1.1000000238419, rz = 181.00012207031, model = 642 },
	{ x = -1124.8438720703, y = 405.59384155273, z = 1.1000000238419, rz = 91.000122070313, model = 642 },
	{ x = -1125.5435791016, y = 445.99389648438, z = 1.1000000238419, rz = 91.000122070313, model = 642 },
	{ x = -1135.5434570313, y = 477.04376220703, z = 1.1000000238419, rz = 321.00012207031, model = 642, rz_fix = 180 },
	{ x = -1169.6934814453, y = 494.44366455078, z = 1.1000000238419, rz = 345.00006103516, model = 642 },
	{ x = -1208.4429931641, y = 497.79370117188, z = 1.1000000238419, rz = 5.0001220703125, model = 642, rz_fix = 180 },
	{ x = -1244.9934082031, y = 486.29373168945, z = 1.1000000238419, rz = 30.000091552734, model = 642 },
	{ x = -1278.9434814453, y = 476.84375, z = 1.1000000238419, rz = 1.0001220703125, model = 642, rz_fix = 180 },
	{ x = -1314.5958251953, y = 483.74380493164, z = 1.1000000238419, rz = 337.00018310547, model = 642 },
	{ x = -1334.7457275391, y = 506.1438293457, z = 1.1000000238419, rz = 287.00024414063, model = 642, rz_fix = 180 },
	{ x = -1335.6457519531, y = 540.94378662109, z = 1.1000000238419, rz = 256.00024414063, model = 642 },
	{ x = -1341.1453857422, y = 575.69372558594, z = 1.1000000238419, rz = 302.00024414063, model = 642, rz_fix = 180 },
	{ x = -1368.6954345703, y = 601.39379882813, z = 1.1000000238419, rz = 332.00024414063, model = 642 },
	{ x = -1394.4954833984, y = 594.89367675781, z = 1.1000000238419, rz = 56.000244140625, model = 642, rz_fix = 180 },
	{ x = -1415.7459716797, y = 586.04382324219, z = 1.1000000238419, rz = 316.00024414063, model = 642 },
	{ x = -1459.6459960938, y = 627.14379882813, z = 1.1000000238419, rz = 316.00024414063, model = 642, rz_fix = 180 },
	{ x = -1479.2456054688, y = 657.24383544922, z = 1.1000000238419, rz = 290.00024414063, model = 642 },
	{ x = -1499.5454101563, y = 713.44378662109, z = 1.1000000238419, rz = 290.00024414063, model = 642, rz_fix = 180 },
	{ x = -1523.9451904297, y = 737.44372558594, z = 1.1000000238419, rz = 341.00024414063, model = 642 },
	{ x = -1581.3452148438, y = 756.44366455078, z = 1.1000000238419, rz = 341.00024414063, model = 642, rz_fix = 180 },
	{ x = -1614.4451904297, y = 751.49371337891, z = 1.1000000238419, rz = 36.000305175781, model = 642 },
	{ x = -1634.4956054688, y = 753.34368896484, z = 1.1000000238419, rz = 313.00042724609, model = 642, rz_fix = 180 },
	{ x = -1640.6456298828, y = 779.94348144531, z = 1.1000000238419, rz = 253.00036621094, model = 642 },
	{ x = -1653.0457763672, y = 804.49353027344, z = 1.1000000238419, rz = 143.00036621094, model = 642 },
	{ x = -1680.7958984375, y = 832.19360351563, z = 1.1000000238419, rz = 127.00033569336, model = 642 },
	{ x = -1707.8464355469, y = 857.89343261719, z = 1.1000000238419, rz = 146.00033569336, model = 642 },
	{ x = -1741.2962646484, y = 880.44348144531, z = 1.1000000238419, rz = 146.00033569336, model = 642 },
	{ x = -1775.0963134766, y = 894.79351806641, z = 1.1000000238419, rz = 168.00024414063, model = 642 },
	{ x = -1807.1964111328, y = 889.99346923828, z = 1.1000000238419, rz = 209.00018310547, model = 642 },
	{ x = -1833.3961181641, y = 895.79345703125, z = 1.1000000238419, rz = 126.00018310547, model = 642 },
	{ x = -1857.9964599609, y = 906.24334716797, z = 1.1000000238419, rz = 188.00012207031, model = 642 },
	{ x = -1891.1962890625, y = 893.14337158203, z = 1.1000000238419, rz = 215.00012207031, model = 642 },
	{ x = -1924.7963867188, y = 887.79351806641, z = 1.1000000238419, rz = 163.00012207031, model = 642 },

	{ x = -1942.295, y = 911.644, z = 1.1, rz = 90, model = 642 },
	{ x = -1956.1950439453, y = 932.6935058594, z = 1.1000000238419, rz = 156.99993896484, model = 642 },
	{ x = -1982.9950317383, y = 957.2436157227, z = 1.1000000238419, rz = 117.99993896484, model = 642 },
	{ x = -1980.0450195313, y = 987.94375, z = 1.1000000238419, rz = 50.999938964844, model = 642 },
	{ x = -1948.9951538086, y = 1005.8937011719, z = 1.1000000238419, rz = 8.9999389648438, model = 642 },
	{ x = -1935.8450683594, y = 1021.5436035156, z = 1.1000000238419, rz = 90.999969482422, model = 642 },
	{ x = -1918.4451660156, y = 1042.3437133789, z = 1.1000000238419, rz = 8.9999694824219, model = 642 },
	{ x = -1880.1952270508, y = 1039.993737793, z = 1.1000000238419, rz = 344, model = 642 },
	{ x = -1850.4452270508, y = 1044.6936889648, z = 1.1000000238419, rz = 34.000030517578, model = 642 },
	{ x = -1825.2453979492, y = 1070.7934814453, z = 1.1000000238419, rz = 58.000030517578, model = 642 },
	{ x = -1819.0954345703, y = 1102.3933959961, z = 1.1000000238419, rz = 100, model = 642 },
	{ x = -1836.0454467773, y = 1118.4934326172, z = 1.1000000238419, rz = 173, model = 642 },
	{ x = -1871.4956420898, y = 1114.4435668945, z = 1.1000000238419, rz = 200, model = 642 },
	{ x = -1900.9456542969, y = 1122.0435424805, z = 1.1000000238419, rz = 131, model = 642 },
	{ x = -1916.0456298828, y = 1155.9436279297, z = 1.1000000238419, rz = 97, model = 642 },
	{ x = -1903.545690918, y = 1186.0936523437, z = 1.1000000238419, rz = 38.000061035156, model = 642 },
	{ x = -1869.5958007813, y = 1195.1936889648, z = 1.1000000238419, rz = 352.00006103516, model = 642 },
	{ x = -1831.7457641602, y = 1195.1936889648, z = 1.1000000238419, rz = 8.0000610351563, model = 642 },

	-- прыжки
	{ x = -1818.5955810547, y = 1210.4950561523, z = 1.1000000089407, rz = 90.000183105469, model = 642 },
	{ x = -1818.5955810547, y = 1267.8949584961, z = 1.1000000089407, rz = 90.000183105469, model = 642 },
	{ x = -1818.5955810547, y = 1308.2950744629, z = 1.1000000238419, rz = 90.000183105469, model = 642 },
	{ x = -1803.8455200195, y = 1339.2452087402, z = 1.1000000238419, rz = 39.000183105469, model = 642 },
	{ x = -1769.3956298828, y = 1353.1450805664, z = 1.1000000238419, rz = 5.0001831054688, model = 642 },
	{ x = -1743.9953613281, y = 1368.3450012207, z = 1.1000000238419, rz = 57.000122070313, model = 642 },
	{ x = -1743.7952270508, y = 1394.1950988769, z = 1.1000000238419, rz = 122.00009155273, model = 642 },
	{ x = -1769.2451782227, y = 1411.3951721191, z = 1.1000000238419, rz = 170.00006103516, model = 642 },
	{ x = -1801.1450195312, y = 1405.495300293, z = 1.1000000238419, rz = 211, model = 642 },
	{ x = -1835.7451782227, y = 1384.6952514648, z = 1.1000000238419, rz = 211, model = 642 },
	{ x = -1868.6951293945, y = 1385.3950805664, z = 1.1000000238419, rz = 120.99993896484, model = 642 },
	{ x = -1867.8948364258, y = 1418.3438720703, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -1833.2948608398, y = 1439.1439208984, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -1798.6948242188, y = 1459.9439697266, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -1748.1948242188, y = 1490.2440185547, z = 1.1000000238419, rz = 30.999938964844, model = 642 },

	-- извилистые
	{ x = -1734.695, y = 1514.044, z = 1.1, rz = 90, model = 642 },
	{ x = -1748.5950439453, y = 1535.0935058594, z = 1.1000000238419, rz = 156.99993896484, model = 642 },
	{ x = -1775.3950317383, y = 1559.6436157227, z = 1.1000000238419, rz = 117.99993896484, model = 642 },
	{ x = -1772.4450195312, y = 1590.34375, z = 1.1000000238419, rz = 50.999938964844, model = 642 },
	{ x = -1741.3951538086, y = 1608.2937011719, z = 1.1000000238419, rz = 8.9999389648438, model = 642 },
	{ x = -1728.2450683594, y = 1623.9436035156, z = 1.1000000238419, rz = 90.999969482422, model = 642 },
	{ x = -1710.8451660156, y = 1644.7437133789, z = 1.1000000238419, rz = 8.9999694824219, model = 642 },
	{ x = -1672.5952270508, y = 1642.393737793, z = 1.1000000238419, rz = 344, model = 642 },
	{ x = -1642.8452270508, y = 1647.0936889648, z = 1.1000000238419, rz = 34.000030517578, model = 642 },
	{ x = -1617.6453979492, y = 1673.1934814453, z = 1.1000000238419, rz = 58.000030517578, model = 642 },
	{ x = -1611.4954345703, y = 1704.7933959961, z = 1.1000000238419, rz = 100, model = 642 },
	{ x = -1628.4454467773, y = 1720.8934326172, z = 1.1000000238419, rz = 173, model = 642 },
	{ x = -1663.8956420898, y = 1716.8435668945, z = 1.1000000238419, rz = 200, model = 642 },
	{ x = -1693.3456542969, y = 1724.4435424805, z = 1.1000000238419, rz = 131, model = 642 },
	{ x = -1708.4456298828, y = 1758.3436279297, z = 1.1000000238419, rz = 97, model = 642 },
	{ x = -1695.945690918, y = 1788.4936523438, z = 1.1000000238419, rz = 38.000061035156, model = 642 },
	{ x = -1661.9958007812, y = 1797.5936889648, z = 1.1000000238419, rz = 352.00006103516, model = 642 },
	{ x = -1624.1457641602, y = 1797.5936889648, z = 1.1000000238419, rz = 8.0000610351563, model = 642 },
	{ x = -1588.0457885742, y = 1790.8936767578, z = 1.1000000238419, rz = 331.00006103516, model = 642 },

	-- прыжки
	{ x = -1571.8955810547, y = 1794.7450561523, z = 1.1000000089407, rz = 90.000183105469, model = 642 },
	{ x = -1571.8955810547, y = 1852.1449584961, z = 1.1000000089407, rz = 90.000183105469, model = 642 },
	{ x = -1571.8955810547, y = 1892.5450744629, z = 1.1000000238419, rz = 90.000183105469, model = 642 },
	{ x = -1557.1455200195, y = 1923.4952087402, z = 1.1000000238419, rz = 39.000183105469, model = 642 },
	{ x = -1522.6956298828, y = 1937.3950805664, z = 1.1000000238419, rz = 5.0001831054688, model = 642 },
	{ x = -1497.2953613281, y = 1952.5950012207, z = 1.1000000238419, rz = 57.000122070313, model = 642 },
	{ x = -1497.0952270508, y = 1978.4450988769, z = 1.1000000238419, rz = 122.00009155273, model = 642 },
	{ x = -1522.5451782227, y = 1995.6451721191, z = 1.1000000238419, rz = 170.00006103516, model = 642 },
	{ x = -1554.4450195312, y = 1989.745300293, z = 1.1000000238419, rz = 211, model = 642 },
	{ x = -1589.0451782227, y = 1968.9452514648, z = 1.1000000238419, rz = 211, model = 642 },
	{ x = -1621.9951293945, y = 1969.6450805664, z = 1.1000000238419, rz = 120.99993896484, model = 642 },
	{ x = -1621.1948364258, y = 2002.5938720703, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -1586.5948608398, y = 2023.3939208984, z = 1.1000000238419, rz = 30.999938964844, model = 642 },

	--

	{ x = -1576.0428466797, y = 2045.8939819336, z = 1.1000000238419, rz = 100.00012207031, model = 642 },
	{ x = -1583.0427246094, y = 2085.6940612793, z = 1.1000000238419, rz = 100.00012207031, model = 642 },
	{ x = -1599.0430908203, y = 2098.8938598633, z = 1.1000000238419, rz = 181.00012207031, model = 642 },
	{ x = -1611.9432373047, y = 2116.2939147949, z = 1.1000000238419, rz = 271.00024414063, model = 642, rz_fix = 180 },
	{ x = -1612.6434326172, y = 2156.6939697266, z = 1.1000000238419, rz = 271.00024414063, model = 642 },
	{ x = -1630.4927978516, y = 2168.943939209, z = 1.1000000238419, rz = 181.00012207031, model = 642 },
	{ x = -1670.8939208984, y = 2168.2438354492, z = 1.1000000238419, rz = 181.00012207031, model = 642 },
	{ x = -1688.8438720703, y = 2185.5938415527, z = 1.1000000238419, rz = 91.000122070313, model = 642 },
	{ x = -1689.5435791016, y = 2225.9938964844, z = 1.1000000238419, rz = 91.000122070313, model = 642 },
	{ x = -1699.5434570313, y = 2257.043762207, z = 1.1000000238419, rz = 321.00012207031, model = 642, rz_fix = 180 },
	{ x = -1733.6934814453, y = 2274.4436645508, z = 1.1000000238419, rz = 345.00006103516, model = 642 },
	{ x = -1772.4429931641, y = 2277.7937011719, z = 1.1000000238419, rz = 5.0001220703125, model = 642, rz_fix = 180 },
	{ x = -1808.9934082031, y = 2266.2937316894, z = 1.1000000238419, rz = 30.000091552734, model = 642 },
	{ x = -1842.9434814453, y = 2256.84375, z = 1.1000000238419, rz = 1.0001220703125, model = 642, rz_fix = 180 },
	{ x = -1878.5958251953, y = 2263.7438049316, z = 1.1000000238419, rz = 337.00018310547, model = 642 },
	{ x = -1898.7457275391, y = 2286.1438293457, z = 1.1000000238419, rz = 287.00024414063, model = 642, rz_fix = 180 },
	{ x = -1899.6457519531, y = 2320.9437866211, z = 1.1000000238419, rz = 256.00024414063, model = 642 },
	{ x = -1905.1453857422, y = 2355.6937255859, z = 1.1000000238419, rz = 302.00024414063, model = 642, rz_fix = 180 },
	{ x = -1932.6954345703, y = 2381.3937988281, z = 1.1000000238419, rz = 332.00024414063, model = 642 },
	{ x = -1958.4954833984, y = 2374.8936767578, z = 1.1000000238419, rz = 56.000244140625, model = 642, rz_fix = 180 },
	{ x = -1979.7459716797, y = 2366.0438232422, z = 1.1000000238419, rz = 316.00024414063, model = 642, rz_fix = 180 },
	{ x = -2023.6459960938, y = 2407.1437988281, z = 1.1000000238419, rz = 316.00024414063, model = 642, rz_fix = 180 },
	{ x = -2043.2456054688, y = 2437.2438354492, z = 1.1000000238419, rz = 290.00024414063, model = 642 },
	{ x = -2063.5454101563, y = 2493.4437866211, z = 1.1000000238419, rz = 290.00024414063, model = 642, rz_fix = 180 },
	{ x = -2087.9451904297, y = 2517.4437255859, z = 1.1000000238419, rz = 341.00024414063, model = 642 },
	{ x = -2145.3452148438, y = 2536.4436645508, z = 1.1000000238419, rz = 341.00024414063, model = 642, rz_fix = 180 },
	{ x = -2178.4451904297, y = 2531.4937133789, z = 1.1000000238419, rz = 36.000305175781, model = 642 },
	{ x = -2198.4956054688, y = 2533.3436889648, z = 1.1000000238419, rz = 313.00042724609, model = 642, rz_fix = 180 },
	{ x = -2204.6456298828, y = 2559.9434814453, z = 1.1000000238419, rz = 253.00036621094, model = 642 },
	{ x = -2217.0457763672, y = 2584.4935302734, z = 1.1000000238419, rz = 143.00036621094, model = 642 },
	{ x = -2244.7958984375, y = 2612.1936035156, z = 1.1000000238419, rz = 127.00033569336, model = 642 },
	{ x = -2271.8464355469, y = 2637.8934326172, z = 1.1000000238419, rz = 146.00033569336, model = 642 },
	{ x = -2305.2962646484, y = 2660.4434814453, z = 1.1000000238419, rz = 146.00033569336, model = 642 },
	{ x = -2339.0963134766, y = 2674.7935180664, z = 1.1000000238419, rz = 168.00024414063, model = 642 },
	{ x = -2371.1964111328, y = 2669.9934692383, z = 1.1000000238419, rz = 209.00018310547, model = 642 },
	{ x = -2397.3961181641, y = 2675.7934570312, z = 1.1000000238419, rz = 126.00018310547, model = 642 },
	{ x = -2421.9964599609, y = 2686.243347168, z = 1.1000000238419, rz = 188.00012207031, model = 642 },
	{ x = -2455.1962890625, y = 2673.143371582, z = 1.1000000238419, rz = 215.00012207031, model = 642 },
	{ x = -2488.7963867188, y = 2667.7935180664, z = 1.1000000238419, rz = 163.00012207031, model = 642 },

	{ x = -2506.295, y = 2691.644, z = 1.1, rz = 90, model = 642 },
	{ x = -2520.1950439453, y = 2712.6935058594, z = 1.1000000238419, rz = 156.99993896484, model = 642 },
	{ x = -2546.9950317383, y = 2737.2436157227, z = 1.1000000238419, rz = 117.99993896484, model = 642 },
	{ x = -2544.0450195313, y = 2767.94375, z = 1.1000000238419, rz = 50.999938964844, model = 642 },
	{ x = -2512.9951538086, y = 2785.8937011719, z = 1.1000000238419, rz = 8.9999389648438, model = 642 },
	{ x = -2499.8450683594, y = 2801.5436035156, z = 1.1000000238419, rz = 90.999969482422, model = 642 },
	{ x = -2482.4451660156, y = 2822.3437133789, z = 1.1000000238419, rz = 8.9999694824219, model = 642 },
	{ x = -2444.1952270508, y = 2819.993737793, z = 1.1000000238419, rz = 344, model = 642 },
	{ x = -2414.4452270508, y = 2824.6936889648, z = 1.1000000238419, rz = 34.000030517578, model = 642 },
	{ x = -2389.2453979492, y = 2850.7934814453, z = 1.1000000238419, rz = 58.000030517578, model = 642 },
	{ x = -2383.0954345703, y = 2882.3933959961, z = 1.1000000238419, rz = 100, model = 642 },
	{ x = -2400.0454467773, y = 2898.4934326172, z = 1.1000000238419, rz = 173, model = 642 },
	{ x = -2435.4956420898, y = 2894.4435668945, z = 1.1000000238419, rz = 200, model = 642 },
	{ x = -2464.9456542969, y = 2902.0435424805, z = 1.1000000238419, rz = 131, model = 642 },
	{ x = -2480.0456298828, y = 2935.9436279297, z = 1.1000000238419, rz = 97, model = 642 },
	{ x = -2467.545690918, y = 2966.0936523437, z = 1.1000000238419, rz = 38.000061035156, model = 642 },
	{ x = -2433.5958007813, y = 2975.1936889648, z = 1.1000000238419, rz = 352.00006103516, model = 642 },
	{ x = -2395.7457641602, y = 2975.1936889648, z = 1.1000000238419, rz = 8.0000610351563, model = 642 },

	-- прыжки
	{ x = -2382.5955810547, y = 2990.4950561523, z = 1.1000000089407, rz = 90.000183105469, model = 642 },
	{ x = -2382.5955810547, y = 3047.8949584961, z = 1.1000000089407, rz = 90.000183105469, model = 642 },
	{ x = -2382.5955810547, y = 3088.2950744629, z = 1.1000000238419, rz = 90.000183105469, model = 642 },
	{ x = -2367.8455200195, y = 3119.2452087402, z = 1.1000000238419, rz = 39.000183105469, model = 642 },
	{ x = -2333.3956298828, y = 3133.1450805664, z = 1.1000000238419, rz = 5.0001831054688, model = 642 },
	{ x = -2307.9953613281, y = 3148.3450012207, z = 1.1000000238419, rz = 57.000122070313, model = 642 },
	{ x = -2307.7952270508, y = 3174.1950988769, z = 1.1000000238419, rz = 122.00009155273, model = 642 },
	{ x = -2333.2451782227, y = 3191.3951721191, z = 1.1000000238419, rz = 170.00006103516, model = 642 },
	{ x = -2365.1450195312, y = 3185.495300293, z = 1.1000000238419, rz = 211, model = 642 },
	{ x = -2399.7451782227, y = 3164.6952514648, z = 1.1000000238419, rz = 211, model = 642 },
	{ x = -2432.6951293945, y = 3165.3950805664, z = 1.1000000238419, rz = 120.99993896484, model = 642 },
	{ x = -2431.8948364258, y = 3198.3438720703, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -2397.2948608398, y = 3219.1439208984, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -2362.6948242188, y = 3239.9439697266, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
	{ x = -2312.1948242188, y = 3270.2440185547, z = 1.1000000238419, rz = 30.999938964844, model = 642 },
}

local CONST_MAP_OBJECT_M_POSITIONS = {
	{ x = -563.59558105469, y = -751.35485839844, z = 3.650000333786, rz = 0, model = 643 },
	{ x = -558.54553222656, y = -751.35485839844, z = 3.650000333786, rz = 0, model = 643 },
	{ x = -520.99487304688, y = -516.15628051758, z = 3.650000333786, rz = 300.99987792969, model = 643 },
	{ x = -428.59475708008, y = -464.20617675781, z = 3.650000333786, rz = 301, model = 643 },
	{ x = -431.59475708008, y = -458.85623168945, z = 3.650000333786, rz = 301, model = 643 },

	{ x = -314.19580078125, y = -67.356391906738, z = 3.650000333786, rz = 121, model = 643 },
	{ x = -316.94598388672, y = -63.106346130371, z = 3.650000333786, rz = 121.00006103516, model = 643 },

	{ x = -602.29558105469, y = -327.85485839844, z = 3.650000333786, rz = 0, model = 643 },
	{ x = -597.24553222656, y = -327.85485839844, z = 3.650000333786, rz = 0, model = 643 },
	{ x = -559.69487304688, y = -92.65628051758, z = 3.650000333786, rz = 300.99987792969, model = 643 },
	{ x = -467.29475708008, y = -40.70617675781, z = 3.650000333786, rz = 301, model = 643 },
	{ x = -470.29475708008, y = -35.35623168945, z = 3.650000333786, rz = 301, model = 643 },

	{ x = -773.34307861328, y = 30.593795776367, z = 3.650000333786, rz = 61.000122070313, model = 643 },
	{ x = -853.19305419922, y = 87.943801879883, z = 3.650000333786, rz = 44.000122070313, model = 643 },
	{ x = -926.59313964844, y = 160.74374389648, z = 3.650000333786, rz = 44.000122070313, model = 643 },
	{ x = -1435.74609375, y = 601.24371337891, z = 3.650000333786, rz = 46.000213623047, model = 643 },
	{ x = -1490.1949462891, y = 679.84368896484, z = 3.650000333786, rz = 20.000244140625, model = 643 },
	{ x = -1548.3958740234, y = 743.0439453125, z = 3.650000333786, rz = 71.000244140625, model = 643 },

	{ x = -1818.5955810547, y = 1235.3951416016, z = 3.650000333786, rz = 0, model = 643 },
	{ x = -1813.5455322266, y = 1235.3951416016, z = 3.650000333786, rz = 0, model = 643 },
	{ x = -1775.9948730469, y = 1470.5937194824, z = 3.650000333786, rz = 300.99987792969, model = 643 },

	{ x = -1571.8955810547, y = 1819.6451416016, z = 3.650000333786, rz = 0, model = 643 },
	{ x = -1566.8455322266, y = 1819.6451416016, z = 3.650000333786, rz = 0, model = 643 },

	--

	{ x = -1999.74609375, y = 2381.2437133789, z = 3.650000333786, rz = 46.000213623047, model = 643 },
	{ x = -2054.1949462891, y = 2459.8436889648, z = 3.650000333786, rz = 20.000244140625, model = 643 },
	{ x = -2112.3958740234, y = 2523.0439453125, z = 3.650000333786, rz = 71.000244140625, model = 643 },
	{ x = -2382.5955810547, y = 3015.3951416016, z = 3.650000333786, rz = 0, model = 643 },
	{ x = -2377.5455322266, y = 3015.3951416016, z = 3.650000333786, rz = 0, model = 643 },
	{ x = -2339.9948730469, y = 3250.5937194824, z = 3.650000333786, rz = 300.99987792969, model = 643 },
	{ x = -2135.8955810547, y = 3599.6451416016, z = 3.650000333786, rz = 0, model = 643 },
	{ x = -2130.8455322266, y = 3599.6451416016, z = 3.650000333786, rz = 0, model = 643 },
}

local CONST_MAP_SPAWN_POSITIONS = {
	{ x = -721.285, y = -1071.956, z = 3.3, rz = 0 },
	{ x = -726.395, y = -1071.956, z = 3.3, rz = 0 },

	{ x = -721.285, y = -1061.956, z = 3.3, rz = 0 },
	{ x = -726.395, y = -1061.956, z = 3.3, rz = 0 },
}

local CONST_COUNT_MARKERS = #CONST_MAP_OBJECT_POSITIONS / CONST_MARKER_STEP

local CLIENT_VAR_map_objects = { }
local CLIENT_VAR_count_marker = nil
local CLIENT_VAR_current_marker = nil
local CLIENT_VAR_current_marker_index = 0
local CLIENT_VAR_timer_marker_index = 1
local CLIENT_VAR_attacker_damage_timer = nil
local CLIENT_VAR_is_vehicle_in_water_timer = nil
local CLIENT_VAR_point_timer = nil
local CLIENT_VAR_snow = nil
local CLIENT_VAR_way_length = nil

local CLIENT_VAR_disabled_keys = { p = true, q = true, tab = true, m = true, y = true, u = true, v = true }

local function SERVER_onPlayerWasted_handler( )
	cancelEvent( )
	PlayerEndEvent( source, "Вы погибли" )
end

local function SERVER_ClientMarkerHit_handler( self, count_marker )
	SyncEventScoreboard( self, event_id .."_PlayerMarkerHit", count_marker, client )
end

local function SERVER_RespawnVehicle_handler( self, position, is_start_position )
	client.vehicle:spawn( position.x, position.y, position.z + 2.2, 0, 0, ( is_start_position and 0 or position.rz - 90 ) + ( position.rz_fix or 0 ) )
	client.vehicle:setEngineState( true )

	for player in pairs( self.players ) do
		triggerClientEvent( player, event_id .."_ChangeCollisionVehicle", resourceRoot, client, self.vehicles )
	end
end

local function CLIENT_ReplaceModel( )
	for k, model_id in pairs( CONST_MAP_OBJECTS ) do
		local col = engineLoadCOL( "models/".. model_id ..".col" )
		engineReplaceCOL( col, model_id )

		local txd = engineLoadTXD( "models/".. model_id ..".txd" )
		engineImportTXD( txd, model_id )

		local dff = engineLoadDFF( "models/".. model_id ..".dff" )
		engineReplaceModel( dff, model_id )

		engineSetModelLODDistance ( model_id, 1000 )
	end
end

local function CLIENT_CreateMapObjects( )	
	for i, object in pairs( CONST_MAP_OBJECT_POSITIONS ) do
		local z_offset = i % 2 > 0 and 0 or 0.01

		CLIENT_VAR_map_objects[ i ] = Object( object.model, object.x, object.y, object.z - z_offset, 0, 0, object.rz )
		CLIENT_VAR_map_objects[ i ]:setDimension( localPlayer.dimension )
		CLIENT_VAR_map_objects[ i ]:setInterior( localPlayer.interior )
		CLIENT_VAR_map_objects[ i ]:setFrozen( true )

		addEventHandler("onClientObjectDamage", CLIENT_VAR_map_objects[ i ], function( )
			cancelEvent()
		end )

		local object = Object( object.model, object.x, object.y, object.z, 0, 0, object.rz )
		object:setDimension( localPlayer.dimension )
		object:setInterior( localPlayer.interior )
		object:setFrozen( true )

		addEventHandler("onClientObjectDamage", object, function( )
			cancelEvent()
		end )

		object:attach( CLIENT_VAR_map_objects[ i ], 0, -5.1, 0, 0, 0, 180 )
	end

	for i, object in pairs( CONST_MAP_OBJECT_M_POSITIONS ) do
		CLIENT_VAR_map_objects[ i + #CONST_MAP_OBJECT_POSITIONS ] = Object( object.model, object.x, object.y, object.z, 0, 0, object.rz )
		CLIENT_VAR_map_objects[ i + #CONST_MAP_OBJECT_POSITIONS ]:setDimension( localPlayer.dimension )
		CLIENT_VAR_map_objects[ i + #CONST_MAP_OBJECT_POSITIONS ]:setInterior( localPlayer.interior )
		CLIENT_VAR_map_objects[ i + #CONST_MAP_OBJECT_POSITIONS ]:setFrozen( true )

		addEventHandler("onClientObjectDamage", CLIENT_VAR_map_objects[ i + #CONST_MAP_OBJECT_POSITIONS ], function( )
			cancelEvent()
		end )
	end
end

if localPlayer then
	CLIENT_ReplaceModel( )
end

local function CLIENT_ChangeCollisionVehicle( player_respawn, data, state )
	local player_respawn_vehicle = player_respawn.vehicle

	if player_respawn_vehicle then
		player_respawn_vehicle:setAlpha( state and 255 or 130 )
	end

	for player, vehicle in pairs( data ) do
		if player ~= player_respawn and isElement( player ) then
			setElementCollidableWith( player_respawn, player, state )
			if player_respawn_vehicle and isElement( vehicle ) then
				setElementCollidableWith( player_respawn_vehicle, vehicle, state )
			end
		end
	end
end

local function CLIENT_onChangeCollisionVehicle_handler( player_respawn, data )
	if not isElement( player_respawn ) then return end
	if player_respawn == localPlayer then
		setCameraTarget( localPlayer )
	end

	CLIENT_ChangeCollisionVehicle( player_respawn, data, false )


	Timer( function( player_respawn, data )
		if not isElement( player_respawn ) then return end
		CLIENT_ChangeCollisionVehicle( player_respawn, data, true )
	end, 5 * 1000, 1, player_respawn, data )
end

local function CLIENT_onClientVehicleDamage_handler( attacker, weapon_id )
	cancelEvent( )
	if not source then return end

	if not attacker or attacker.type ~= "vehicle" then return end

	localPlayer:setData( "attacker", attacker.controller, false )

	if isTimer( CLIENT_VAR_attacker_damage_timer ) then
		killTimer( CLIENT_VAR_attacker_damage_timer )
	end

	CLIENT_VAR_attacker_damage_timer = Timer( function( )
		localPlayer:setData( "attacker", false, false )
	end, 5 * 1000, 1 )
end

local function CLIENT_RaceKeyHandler( key, state )
	if CLIENT_VAR_disabled_keys[ key ] then
		cancelEvent( )
	end
end

local function CLIENT_onClientPlayerDamage_handler( )
	cancelEvent()
end

local function CLIENT_PlayerMarkerHit_handler( player, count_marker, place )
	UpdateScoreboard( player, count_marker, place )
end

local function CLIENT_VAR_get_way_length( )
	if not CLIENT_VAR_current_marker_index or not localPlayer.vehicle then return end
	
	local marker_position = CONST_MAP_OBJECT_POSITIONS[ CLIENT_VAR_current_marker_index * CONST_MARKER_STEP ]
	local vehicle_position = localPlayer.vehicle.position

	if vehicle_position.z < 3 then return end
	if 	localPlayer.vehicle.rotation.x > 120 and localPlayer.vehicle.rotation.x < 220 then return end
	if not marker_position then return end

	local way_length = getDistanceBetweenPoints2D( marker_position.x, marker_position.y, vehicle_position.x, vehicle_position.y )

	return way_length
end

local function CLIENT_CreateNextRaceMarker( is_start )
	if CLIENT_VAR_current_marker and isElement( CLIENT_VAR_current_marker.marker ) then
		destroyElement( CLIENT_VAR_current_marker.marker )
		destroyElement( CLIENT_VAR_current_marker.blip )
	end

	CLIENT_VAR_current_marker_index = CLIENT_VAR_current_marker_index + 1
	CLIENT_VAR_way_length = CLIENT_VAR_get_way_length( )

	local next_marker = CONST_MAP_OBJECT_POSITIONS[ CLIENT_VAR_current_marker_index * CONST_MARKER_STEP ]
	if next_marker then
		CLIENT_VAR_count_marker = is_start and 0 or CLIENT_VAR_count_marker + 1

		TriggerCustomServerEvent( "ClientMarkerHit", CLIENT_VAR_count_marker )
		
		CLIENT_VAR_current_marker = { }
		CLIENT_VAR_current_marker.marker = createMarker( next_marker.x + 2.55, next_marker.y, next_marker.z, "checkpoint", 20, 200, 50, 50 )
		CLIENT_VAR_current_marker.marker.dimension = localPlayer.dimension
		CLIENT_VAR_current_marker.blip = createBlipAttachedTo( CLIENT_VAR_current_marker.marker, 0, 3, 200, 50, 50 )

		addEventHandler( "onClientMarkerHit", CLIENT_VAR_current_marker.marker, function( player, dim )
			if player == localPlayer and dim then
				CLIENT_CreateNextRaceMarker()
			end
		end )

		local target_marker = CONST_MAP_OBJECT_POSITIONS[ ( CLIENT_VAR_current_marker_index + 1 ) * CONST_MARKER_STEP ]
		if not target_marker then return end
		setMarkerTarget( CLIENT_VAR_current_marker.marker, target_marker.x - 2.55, target_marker.y, target_marker.z )
	end
end

function CLIENT_SetSnowState( state )
	if state then
		setWaterColor( 255, 255, 255, 255 )
		CLIENT_VAR_snow = dxCreateShader( "fx/lava.fx" )
		local textura = dxCreateTexture( "img/snow.png" )
		dxSetShaderValue( CLIENT_VAR_snow, "TEXTURE", textura )
		engineApplyShaderToWorldTexture( CLIENT_VAR_snow, "waterclear256" )
	else
		setWaterColor( 93, 170, 170, 240 )
		CLIENT_VAR_snow:destroy( )
		CLIENT_VAR_snow = nil
	end
end

local function CLIENT_DrawStartTimer( )
	local fProgress = ( getTickCount() - CLIENT_VAR_iRaceStarted - CLIENT_VAR_iSecondsPassed*1000 ) / 1000
	local fInterpolated = interpolateBetween(0, 0, 0, _SCREEN_X, 0, 0, fProgress, "OutInBack")

	if fProgress >= 1 then
		CLIENT_VAR_iSecondsPassed = CLIENT_VAR_iSecondsPassed + 1
		if CLIENT_VAR_iSecondsPassed > CLIENT_VAR_iTotalSeconds then
			removeEventHandler( "onClientRender", root, CLIENT_DrawStartTimer )
		elseif CLIENT_VAR_iSecondsPassed == CLIENT_VAR_iTotalSeconds then
			playSound("sounds/start.wav")
		else
			playSound("sounds/timer_tick.wav")
		end
	end
end

local function CLIENT_CheckWay( )
	if CLIENT_VAR_current_marker_index < 2 then return end

	local way_length = CLIENT_VAR_get_way_length( )
	if not way_length then ShowWarningWay( false ) return end
	if not CLIENT_VAR_way_length then CLIENT_VAR_way_length = way_length return end

	local show_warnig_way = way_length > CLIENT_VAR_way_length + 5 and true or false
	ShowWarningWay( show_warnig_way )
	CLIENT_VAR_way_length = way_length
end

REGISTERED_EVENTS[ event_id ] = {
	name = "Опасный спринт";
	group = "new_year";
	count_players = 4;--4
	timeout = 5 * 60;
	scoreboard_text_point = "Количество чекпоинтов:";
	--count_markers = CONST_COUNT_MARKERS;

	coins_reward = {
		[ 1 ] = 42;
		[ 2 ] = 36;
		[ 3 ] = 24;
		[ 4 ] = 18;
	},

	Setup_S_handler = function( self )
		self.vehicles = {}

		local counter = 0
		for player in pairs( self.players ) do
			counter = counter + 1

			local vehicle = Vehicle.CreateTemporary( CONST_VEHICLE_MODEL, CONST_MAP_SPAWN_POSITIONS[ counter ].x, CONST_MAP_SPAWN_POSITIONS[ counter ].y, CONST_MAP_SPAWN_POSITIONS[ counter ].z, 0, 0, CONST_MAP_SPAWN_POSITIONS[ counter ].rz )
			vehicle.dimension = self.dimension
			self.vehicles[ player ] = vehicle

			setTimer( function( )
				player.vehicle = vehicle
				vehicle.frozen = true
			end, 100, 1 )

			addEventHandler( "onPlayerPreWasted", player, SERVER_onPlayerWasted_handler )

		end

		AddCustomServerEventHandler( self, "ClientMarkerHit", SERVER_ClientMarkerHit_handler )
		AddCustomServerEventHandler( self, "ClientRespawnVehicle", SERVER_RespawnVehicle_handler )
	end;

	Setup_S_delay_handler = function( self, players )
		self.start_timer = Timer( function( )
			local players = { }
			for player in pairs( self.players ) do
				if isElement( player.vehicle ) then
					table.insert( players, player )
					player.vehicle.frozen = false
				else
					PlayerEndEvent( player, "Ошибка инициализации" )
				end
			end

			self.end_timer = Timer( function( )
				for k = #self.players_point, 1, -1 do
					PlayerEndEvent( self.players_point[ k ][ 1 ], "Вы заняли ".. k .." место", _, k, true )
				end
			end, CONST_TIME_TO_EVENT_END * 1000 - 3000, 1 )
		end, CONST_TIME_TO_START_EVENT * 1000, 1 )
	end;

	Setup_C_handler = function( players, vehicles )
		if isElement( vehicles[ localPlayer ] ) then
			addEventHandler( "onClientVehicleDamage", vehicles[ localPlayer ], CLIENT_onClientVehicleDamage_handler, true, "high+10000" )
			setVehicleHandling( vehicles[ localPlayer ], "percentSubmerged", 45 )
			setCameraViewMode( 2 )
		end

		localPlayer:setData( "hud_timer_data", false, false )

		addEvent( event_id .."_PlayerMarkerHit", true )
		addEventHandler( event_id .."_PlayerMarkerHit", resourceRoot, CLIENT_PlayerMarkerHit_handler )

		addEvent( event_id .."_ChangeCollisionVehicle", true )
		addEventHandler( event_id .."_ChangeCollisionVehicle", resourceRoot, CLIENT_onChangeCollisionVehicle_handler )

		CLIENT_VAR_current_marker = nil
		CLIENT_VAR_way_length = nil
		CLIENT_VAR_current_marker_index = 0
		CLIENT_VAR_timer_marker_index = 1
		CLIENT_VAR_count_marker = 0

		toggleControl( "enter_exit", false )

		CreateUIStartTimer( CONST_TEXT_TO_START, CONST_TIME_IN_MS_TO_TEXT_START )
		CLIENT_CreateMapObjects( )
		CLIENT_SetSnowState( true )
		CLIENT_CreateNextRaceMarker( true )
		CreateUITimeout( CONST_TIME_TO_EVENT_END )

		removeEventHandler( "onClientKey", root, CLIENT_RaceKeyHandler )
		addEventHandler( "onClientKey", root, CLIENT_RaceKeyHandler )

		addEventHandler( "onClientPlayerDamage", localPlayer, CLIENT_onClientPlayerDamage_handler )

		CLIENT_VAR_iRaceStarted = getTickCount()
		CLIENT_VAR_iSecondsPassed = 0
		CLIENT_VAR_iTotalSeconds = iSeconds or 3
		addEventHandler( "onClientRender", root, CLIENT_DrawStartTimer )
		playSound( "sounds/timer_tick.wav" )

		CLIENT_VAR_is_vehicle_in_water_timer = Timer( function( )
			if localPlayer.vehicle and ( isElementInWater( localPlayer.vehicle ) or ( localPlayer.vehicle.rotation.x > 120 and localPlayer.vehicle.rotation.x < 220 ) ) then
				local is_start_position = CLIENT_VAR_count_marker == 0

				local position = is_start_position and CONST_MAP_SPAWN_POSITIONS[ math.random( 1, #CONST_MAP_SPAWN_POSITIONS ) ] or CONST_MAP_OBJECT_POSITIONS[ CLIENT_VAR_count_marker * CONST_MARKER_STEP ]

				if not is_start_position and #getElementsWithinRange( position.x, position.y, position.z, 1, "vehicle" ) > 0 then
					local attach_object = CLIENT_VAR_map_objects[ CLIENT_VAR_count_marker * CONST_MARKER_STEP ]:getAttachedElements( )[ 1 ]
					if attach_object then
						local attach_position = attach_object.position
						position = {
							x = attach_position.x,
							y = attach_position.y,
							z = attach_position.z,
							rz = position.rz
						}
					end
				end

				TriggerCustomServerEvent( "ClientRespawnVehicle", position, is_start_position )

				CLIENT_VAR_way_length = CLIENT_VAR_get_way_length( )

				local attacker = localPlayer:getData( "attacker" )
				if isElement( attacker ) then
					triggerServerEvent( "BP:NYE:onPlayerPushOffOtherCar", attacker, event_id )
					localPlayer:setData( "attacker", false, false )
				end
			end
		end, 1000, 0 )

		CLIENT_VAR_point_timer = Timer( function( )
			if CLIENT_VAR_timer_marker_index == CLIENT_VAR_current_marker_index then
				localPlayer:InfoWindow( "Исключен за не активную игру" )
				triggerServerEvent( "PlayerQuitAfk", resourceRoot )
			else
				CLIENT_VAR_timer_marker_index = CLIENT_VAR_current_marker_index
			end

		end, CONST_TIME_HIT_POINT * 1000, 0 )

		CLIENT_VAR_warning_way_timer = setTimer( CLIENT_CheckWay, 500, 0 )
	end;

	CleanupPlayer_S_handler = function( self, player )
		removeEventHandler( "onPlayerPreWasted", player, SERVER_onPlayerWasted_handler )

		if isElement( self.vehicles[ player ] ) then
			destroyElement( self.vehicles[ player ] )
		end
	end;

	Cleanup_S_handler = function( self )
		if isTimer( self.start_timer ) then
			killTimer( self.start_timer )
		end

		if isTimer( self.end_timer ) then
			killTimer( self.end_timer )
		end

		RemoveCustomServerEventHandler( self, "ClientMarkerHit" )
		RemoveCustomServerEventHandler( self, "ClientRespawnVehicle" )
	end;

	Cleanup_C_handler = function( )
		removeEventHandler( event_id .."_PlayerMarkerHit", resourceRoot, CLIENT_PlayerMarkerHit_handler )
		removeEventHandler( event_id .."_ChangeCollisionVehicle", resourceRoot, CLIENT_onChangeCollisionVehicle_handler )

		CLIENT_SetSnowState( false )
		ShowWarningWay( false )

		toggleControl( "enter_exit", true )

		removeEventHandler( "onClientKey", root, CLIENT_RaceKeyHandler )
		removeEventHandler( "onClientPlayerDamage", localPlayer, CLIENT_onClientPlayerDamage_handler )

		if isTimer( CLIENT_VAR_is_vehicle_in_water_timer ) then
			killTimer( CLIENT_VAR_is_vehicle_in_water_timer )
		end

		if isTimer( CLIENT_VAR_point_timer ) then
			killTimer( CLIENT_VAR_point_timer )
		end

		if isTimer( CLIENT_VAR_warning_way_timer ) then
			killTimer( CLIENT_VAR_warning_way_timer )
		end

		for _, object in pairs( CLIENT_VAR_map_objects ) do
			local attach_object = object:getAttachedElements( )[ 1 ]
			if attach_object then attach_object:destroy( ) end
			object:destroy( )
		end

		if CLIENT_VAR_current_marker and isElement( CLIENT_VAR_current_marker.marker ) then
			destroyElement( CLIENT_VAR_current_marker.marker )
			destroyElement( CLIENT_VAR_current_marker.blip )
		end

		if isTimer( CLIENT_VAR_attacker_damage_timer ) then
			killTimer( CLIENT_VAR_attacker_damage_timer )
			localPlayer:setData( "attacker", false, false )
		end

		removeEventHandler( "onClientRender", root, CLIENT_DrawStartTimer )
	end;
}

-- Тестирование
if not localPlayer and SERVER_NUMBER > 100 then
	addCommandHandler( "new_year_dangerous_sprint", function( player, cmd, count )
		if not count then player:ShowError( "Введите количество игроков" ) return end
		count = tonumber( count )
		if count > 4 or count < 1 then player:ShowError( "Введите количество 1-4" ) return end
		player:ShowInfo( "Количество игроков " .. count )
        REGISTERED_EVENTS[ event_id ].count_players = count
	end )
	
	addCommandHandler( "new_year_dangerous_sprint_min_time", function( player )
        player:ShowInfo( "Время игры сокращено до 30 секунд" )
		CONST_TIME_TO_EVENT_END = 30
		REGISTERED_EVENTS[ event_id ].timeout = 30
	end )

	addCommandHandler( "new_year_dangerous_sprint_min_time_reset", function( player )
		player:ShowInfo( "Сброшено время игры" )
		CONST_TIME_TO_EVENT_END = 5 * 60
		REGISTERED_EVENTS[ event_id ].timeout = 5 * 60
	end )

	--

	addCommandHandler( "new_year_place", function( player, cmd, place )
		if not place then player:ShowError( "Введите желаемое место" ) return end
		player:ShowInfo( "Желаемое место " .. place )
        player:setData( "new_year_place", tonumber( place ), false )
	end )
	
	addCommandHandler( "reset_new_year_place", function( player )
        player:ShowInfo( "Желаемое место сброшено" )
        player:setData( "new_year_place", false, false )
	end )
end

