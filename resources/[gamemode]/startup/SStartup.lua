PRE_START_RESOURCES = {
    "interfacer",
    "nrp_mariadb",
}

STARTUP_RESOURCES = {
"dgs",
    "nrp_ib",
    "nrp_key_action_handler",

	"nrp_models_loader",

    "nrp_content",
    
    "nrp_player",
    
    "nrp_handler_sound",
    "nrp_sounds",
    "nrp_fonts",
        
    "nrp_driving_school",
	
	"nrp_discount_manager",
    "nrp_donate",
    "nrp_inventory",
    "nrp_phone",
    "nrp_sim_shop",
    
    "nrp_audiozones",
    "nrp_timecycle",
    "nrp_world",
	"nrp_gtasa_fixes",
    
    "nrp_handler_chat",
    "nrp_handler_voice",
    "nrp_voice_station",
    "nrp_radial_menu",
    "nrp_handler_camera",
    
    "nrp_report",
    "nrp_commands",
    
    "nrp_hud",
    "nrp_passenger_gps_tags",
    --"nrp_ui_donate",
    "nrp_shop",
    "nrp_ui_adminpanel",
    "nrp_ui_notifications",
    "nrp_ui_nametags",
    
    "nrp_vehicle_windows",
    "nrp_vehicle_engine_sounds",
    "nrp_vehicle_components",
    "nrp_vehicle_numberplates",
    "nrp_vehicle_firstperson",
    "nrp_vehicle_wheels",
    "nrp_vehicle_collision",
    "nrp_vehicle_reverse",
    "nrp_vehicle_height",
    "nrp_vehicle_radio",
    "nrp_vehicle_damage",
    "nrp_vehicle_cruise",
    "nrp_vehicle_inventory",

    "nrp_levels",
    "nrp_quests",
    
	"nrp_edata_security",
	
	"nrp_hard_refill",
    
    "nrp_business_gasstation",
    "nrp_business_repairstore",
    "nrp_business_cartrade",
    "nrp_business_carsell",
    
    --"nrp_tutorial",
    "nrp_tutorial_new",
    "nrp_tutorial_hints",
    "nrp_tutorial_lawyer",
    "nrp_tutorial_nodamage",

    --"quest_alexander_get_vehicle",
    "quest_alexander_get_vehicle_bike",
    "quest_jeka_testdrive",
    "quest_oleg_courier",
    "quest_angela_cinema",
    "quest_alexander_debt",
    "quest_alexander_talks",
    "quest_angela_risks",
    "quest_oleg_govhelp",
    "quest_oleg_parkemployee",
    "quest_jeka_race",
    "quest_jeka_capture",
    "quest_angela_dance_school",
    "quest_ksusha_hotel",
    "quest_delivery_of_goods",
    "quest_fast_delivery",
    "quest_rescue_operation",
    "quest_return_of_property",
    "quest_unconscious_betrayal",
    "quest_real_initiative",
    "nrp_gifts",
    "nrp_free_cases",
    "quest_return_of_history",
    "quest_protection",
    "quest_angela_problems",
    "quest_long_awaited_meeting",
    "quest_beginning_proceedings",
    "quest_good_game",
    "quest_murderous_setup",
    "quest_crazy_vacation",
    "quest_the_inevitable_path",
    "quest_possible_exposure",
    "quest_bloody_forest",
    "quest_long_awaited_revenge",

    
    "nrp_handler_markers",
    "nrp_green_zones",
    "nrp_hospitals",
    
    --"nrp_handler_player_tasks",
    "nrp_player_walkstyle",
    "nrp_player_playingtime",
    "nrp_player_afk_detector",
    "nrp_player_hunger",
    "nrp_player_stamina",
    "nrp_player_jumplimit",
    "nrp_player_collisions",
    "nrp_player_chatbox",
    "nrp_player_position",
    "nrp_player_buffs",
    
    "nrp_drugstore",
    
    "nrp_documents",
    
    "nrp_api",
    "nrp_admin",
    "nrp_promo",
    "nrp_shaders",
    
    
    
    --"quest_angela_1",
    --"quest_angela_2",
    --"quest_angela_3",
    --"quest_angela_4",
    --"quest_angela_5",
    --"quest_ivanovich_1",
    --"quest_ivanovich_2",
    --"quest_ivanovich_3",
    --"quest_shmatko_1",
    --"quest_shmatko_2",
    --"quest_shmatko_3",
    
    --"Int_Tuning",
    --"Int_Shop",
    --"Int_Padik_1",
    --"Int_AutoSchool",
    
    
    --"nrp_dev2dev",
    "nrp_analytics",
    "nrp_elastic",
    
    
    -- FACTIONS UPDATE
    
    "quest_urgent_military_1",
    "quest_urgent_military_2",
    
    --"task_dps_1",
    "task_medic_1",
    "task_medic_2",
    "task_medic_3",
    "task_medic_4",
    "task_medic_5",
    "task_military_1",
    "task_military_2",
    "task_military_3",
    "task_police_1",
    "task_police_2",
    "task_police_3",
    "task_pps_1",
    "task_mayor_1",
    "task_mayor_2",
    "task_mayor_3",
    "task_mayor_4",

    "task_fsin_1",
    "task_fsin_2",
    "task_fsin_3",
    "task_fsin_4",
    "task_jail_1",
    "task_jail_2",
    "task_jail_3",
    "nrp_fsin_info",
    "nrp_fsin_jail",

    "nrp_route_constructor",
    "nrp_handler_weapons",
    
    "nrp_faction_vehicles",
    "nrp_factions_documents_check",
    
    "nrp_factions_handcuffs",
    "nrp_factions_handler_wanted",
    "nrp_factions_parachute",
    "nrp_factions_interiors",
    "nrp_factions_payout",
    "nrp_factions_day_off",
    "nrp_factions_stinger",
    "nrp_factions_taser",
    "nrp_factions_ui_control_menu",
    "nrp_factions_ui_info",
    "nrp_factions_ui_ranks",
    "nrp_factions_vehicle_siren",
    "nrp_jail",
    "nrp_fines",
    "nrp_speed_radars",
    "nrp_urgent_military_limiter",
    "nrp_urgent_military_ui",
    
    "nrp_ui_payoffers",
    "nrp_webshop",
    
    "Int_Police_Nsk",
    "Int_DPS_Nsk",
    "Int_Police_Gorki",
    "Int_DPS_Gorki",
    "Int_Medic",
    "Int_Medic_Msk",
    "Int_Fsin_Nsk",
    "Army",
    "Int_Mayor_Nsk",
    "Int_Mayor_Msk",
    "Int_Mayor_Gorki",
    "Int_Police_Msk",
    "Int_DPS_Msk",
    "nrp_doors",
    
    "nrp_driveby",
    "nrp_vehpanel",
    "nrp_vehicle_signals",
    
    "nrp_ui_roulette",
    
    "nrp_clans",
    "nrp_clans_buffs",
    "nrp_clans_drugs",
    "nrp_clans_objects",
    "nrp_clans_shop",
    "nrp_clans_gundealer",
    "nrp_clans_storage",
    "nrp_clans_factory_alco",
    "nrp_clans_factory_hash",
    "nrp_clans_freezer",
    "nrp_clans_ui_create_join",
    "nrp_clans_ui_requests",
    "nrp_clans_ui_main",
    "nrp_clans_ui_manage",
    "nrp_clans_ui_cartel",
    "nrp_clans_ui_cartel_tax",
    "nrp_clans_cartel_vehicles",
    "nrp_clans_markers",
    "nrp_clans_compensation",
    "nrp_clans_events",
    "nrp_game_clantags",
    "nrp_game_packages",
    "nrp_game_cargodrop",
    "nrp_game_holdarea",
    "nrp_game_team_deathmatch",
    -- "nrp_game_capture_points",
    
    --"nrp_slots_manager",
    "nrp_factions_voice",
    
    "perfdebug",
    "nrp_ui_rules",
    "nrp_handler_premium",
    
    "nrp_refferals",
    
    -- Faction Lobbies Update
    "nrp_factions_ui_training",
    "training_military_delivery_driver",
    "training_military_delivery_pilot",
    "training_military_delivery_s_armed",
    "nrp_game_truckcrate",
    
    -- Faction Lobbies Update №2
    "training_military_skydiving_aircraft",
    "training_military_skydiving_heli",
    "training_military_skydiving_s_skydiver",
    "task_dps_2",
    "task_dps_3",
    "task_dps_4",
    "task_military_4",
    "task_military_5",
    "task_military_6",
    "task_military_7",
    "nrp_faction_history",
    "nrp_factions_boards",
    
    -- Faction Lobbies Update №3
    "nrp_game_ambassador",
    "training_ambassador_delivery_driver",
    "training_ambassador_delivery_s_fdriver",
    "training_ambassador_delivery_s_post",
    "training_ambassador_delivery_s_armed",
    
    -- Casino Update
    "nrp_shared",
    "nrp_casino_bar",
    "nrp_casino_game_fool",
    "nrp_casino_game_dice",
    "nrp_casino_game_roulette",
    "nrp_casino_game_classic_roulette",
    "nrp_casino_black_jack",
    "nrp_casino_game_slot_machine",
    "nrp_casino_game_lottery",
    "nrp_casino_lobby",
    "nrp_casino_entrance",
    
    -- Daily Awards
    "nrp_daily_awards",
    
    -- Cases
    --"nrp_cases",
    
    -- Training Demining
    "training_demining_army",
    "training_demining_dps",
    "training_demining_medic",
    "training_demining_pps",
    "training_demining_s_army",
    "training_demining_s_dps",
    "training_demining_s_medic",
    "training_demining_s_pps",
    "nrp_factions_demining",
     "nrp_factions_reanimation",
    
    -- Registration offers and other
    -- "nrp_payoffers_segmented",
    
    -- Dancing School
    "nrp_dancing_school",
    
    -- Quests Update
    --"quest_shmatko_4",
    --"quest_ali_1",
    --"quest_ali_2",
    --"quest_vasya_1",
    --"quest_vasya_2",
    --"quest_dominic_1",

    "nrp_player_offline",

    -- Fight Club
    "nrp_fight_club",
    
    -- Accessories
    "nrp_handler_accessories",
    "nrp_clothes_shop",
    
    -- Houses
    "nrp_apartment",
    "nrp_vip_house",
    "nrp_house_bed",
    "nrp_house_call",
    "nrp_house_control",
    "nrp_house_garage",
    "nrp_house_wardrobe",
    "nrp_house_cooking",
    "nrp_house_inventory",
    "nrp_house_sale",

    -- Economics
    "nrp_ui_rewards",
    "nrp_handler_economy",
    
    -- Tuning and Races
    "nrp_tuning_cases",
    "nrp_tuning_shop",
    "nrp_vinyls",
    "nrp_vehicle_passport",
    "nrp_vehicle_tuning",
    "nrp_tuning_internal_parts",
    --"nrp_vehicle_tuning_refunds",
    
    --"quest_jeka_1",
    "nrp_vehicle_record",
    --"quest_jeka_2",
    
    "nrp_job_coop_controller",

    -- New jobs update
    "nrp_jobs_ac",
    "nrp_job_controller",
    "task_tow_company",
    "task_incasator_coop",
    "task_trashman_coop",
    "task_industrial_fishing_coop",
    "task_hijack_cars_coop",
    "task_delivery_cars_coop",
    "task_courier_base",
    "task_courier_company",
    "task_driver_company",
    "task_farmer_helper",
    "task_farmer_company",
    "task_loader_base",
    "task_loader_company",
    "task_taxi_company",
    "task_trucker_company",
    "task_mechanic_company",
    "task_park_employee_company_1",
    "task_park_employee_company_2",
    "task_park_employee_company_3",
    
    "task_woodcutter_company_1",
    "task_woodcutter_company_2",
    "task_woodcutter_company_3",
    
    "task_hcs_company_1",
    "task_hcs_company_2",
    "task_hcs_company_3",

    "nrp_job_vehicles",
    "nrp_interiors",
    "training_ambassador_delivery_gorki_driver",
    "training_ambassador_delivery_gorki_s_armed",
    "training_ambassador_delivery_gorki_s_fdriver",
    "training_ambassador_delivery_gorki_s_post",
    "training_murder_gorki_dps",
    "training_murder_gorki_medic",
    "training_murder_gorki_pps",
    "training_murder_gorki_s_dps",
    "training_murder_nsk_dps",
    "training_murder_nsk_medic",
    "training_murder_nsk_pps",
    "training_murder_nsk_s_dps",
    "training_cityhall_rating_mayor",
    "training_cityhall_rating_s_armed",
    "training_cityhall_rating_gorki_mayor",
    "training_cityhall_rating_gorki_s_armed",
    "training_cityhall_rating_msk_mayor",
    "training_cityhall_rating_msk_s_armed",
    
    -- Businesses and New Cases update
    "nrp_handler_temp_veh",
    "nrp_vehicle_fire_cancel",
    "nrp_businesses",
	"nrp_businesses_office",
	"nrp_businesses_shop",

    -- Fishing, New businesses, ib update
    "nrp_hobby_inventory",
    "nrp_hobby_hunting",
    "nrp_hobby_fishing",
    "nrp_hobby_digging",

    -- Таксист частник
    "task_taxi_private",

    -- Пилот
    "task_pilot_company",
    "task_pilot_airplane",
    "task_pilot_airplane_drop",

    -- Ивент к 1 сентября
    "nrp_1september",

    -- Оффер на 3 дня (с 27 мая)
    "nrp_offer_3days_no_payment",

    -- Оффер х2 для всех
    "nrp_welcome_x2",

    -- Оффер на машину
    "nrp_offer_vehicle",

    -- Оффер на лицензию на оружие
    "nrp_offer_gun_license",

    -- Авиа
    "nrp_airplane_market",
    "nrp_airplane_repair",
    "nrp_no_vehicle_zones",
    "nrp_special_speed_limits",
    "nrp_airplane_chassis",

    -- Кинотеатр
    "nrp_cinema",
    "nrp_cinema_entrance",
    "nrp_cinema_lights",

	-- Мэрия
	"nrp_factions_gov_ui_control",
	"nrp_factions_gov_voting",

    -- Зоны без коллизий транспорта
    "nrp_no_collision_zones",

    -- Статы оружия и тд
    "nrp_player_stats",

    --"nrp_player_stats"

    "nrp_cases50",
    "nrp_cases_sale_ending",

    "nrp_cases_discount",
    "nrp_vinyl_cases_discount",
    "nrp_job_leave",
    "nrp_question_form",
    -- "nrp_question_band",
    "nrp_carousel",
	"nrp_vehicle_govsell",

    "nrp_boat_driving_school",
    "nrp_boat_repair",
    "nrp_boats_market",

    -- Новое меню помощи
    "nrp_help",

    --"nrp_segmented_cardiscount",
    "nrp_retention_tasks",
    "nrp_retention_tasks_controller",
    --"nrp_segmented_retentiontasks",
    --"nrp_segmented_premium",
	"nrp_special_thks_rewards",
    "nrp_annuity_payments",
    "nrp_return_offer",

	"nrp_events",
	"nrp_event_shop",

    "nrp_explosion",
    "nrp_memory_sa",

    "nrp_barriers",
    "nrp_forbidden_parking",
    "nrp_faction_shift_plan",

    "nrp_player_giveonjoin",
    "nrp_transfer",
    --"nrp_project_birthday",

    --"nrp_snow",

    "nrp_vehicle",
    "nrp_drift_camera",

    "nrp_strip_club",

    --"nrp_segmented_economy",
    --"nrp_segmented_vehdiscount",
    "nrp_segmented_casino_0_day",
    "nrp_segmented_economy_hard",
    "nrp_test_offer_comfort_start",

    "nrp_offer_premium_fast",
    "nrp_offer_premium_nopurchase",
    "nrp_offer_premium_3d",
    "nrp_offer_premium_extension",
    "nrp_offer_premium_share",
    "nrp_offer_last_wealth",
    "nrp_offer_newyear_auction",
    "nrp_offer_ingame_draw",
    "nrp_offer_valentine_day",
    "nrp_offer_defender_fatherland_day",
    "nrp_offer_8_march",
    "nrp_short_offer_first_vehicle",
    "nrp_short_offer_second_vehicle",
    --"nrp_short_offer_5lvl_up",
    "nrp_short_offer_casino",
    "nrp_short_offer_vacation_time",
    "nrp_short_offer_rally",
    "nrp_short_offer_clan_recruit",
    "nrp_short_offer_sick_player",
    "nrp_short_offer_first_house",
    --"nrp_short_offer_first_moto",

    "nrp_offer_piggy_bank",

    "nrp_offer_skin",
    "nrp_offer_property",
    "nrp_offer_first_weapon",
    "nrp_offer_clan",
    "nrp_offer_tuning_kit",
    "nrp_offer_discount_gift",

    "nrp_ind_offer_accessory",
    "nrp_ind_offer_vehicle",
    "nrp_ind_offer_wof",

    --"nrp_daily_compensation",

	"nrp_segmented_x2_11_day",

    "nrp_special_cases30_last_discount",
    "nrp_special_apartments_offer",
	"nrp_special_businesses_offer",
    "nrp_third_payment",
    
    "nrp_special_apartments_offer",

    "nrp_race_powerups_effects",
    "nrp_races",
    "nrp_race_constructor",

    "nrp_social_interaction",
    "nrp_bounty_system",
    "nrp_achievements",
    "nrp_wedding",

    "nrp_player_diseases",
    "nrp_medbook",
    "nrp_medic_treating",
    "nrp_medic_reviving",

    "nrp_weapon_store",

    "nrp_skybox",
    "nrp_photo_mode",

    "nrp_vehicle_conditions",
    "nrp_vehicle_helmets",

    "nrp_live_case_drops",
    "nrp_neons",
    --"nrp_party",
    "nrp_jumps",

    "nrp_battle_pass",
    "nrp_season_cases_info",

    -- DEFAULT
    "ajax",
    "webadmin",
    "admin",
    --"defaultstats",
    "performancebrowser",
    "reload",
    "resourcebrowser",
    "resourcemanager",
    --"elementbrowser",
    "runcode",
    "bone_attach",

    "nrp_special_offer_for_whales",
    "nrp_cases_offers",
    "nrp_premium_giveaway",
    "nrp_first_case_gift",
    "nrp_cases_pack_offer",
    "nrp_cases_premium_discount",
    "nrp_assembly_vehicle",
    "nrp_double_mayhem",
    "nrp_bosow_bundle",
    "nrp_danilych_bundle",
    "nrp_cases_7discount",
    "nrp_vehicle_auction",

    "nrp_casino_rmt_detect",
    "nrp_fight_club_rmt_detect",
	"nrp_ac_libs",
	"nrp_ac",

    "nrp_billboards",

    "nrp_prometheus",

    "nrp_coop_quests",

    "nrp_cases_wholesome_discount",
	
	"nrp_vehicle_fire_off",
}

SERVER_RESOURCES = {
    [ 1 ] ={
        --"nrp_segmented_packs"
    },
    -- Дев1, Ебланский
    [ 101 ] = {
        "model_replace",
        "nrp_vehicle_configurator",
        "test_overlay",
    },
    --[[[ 8 ] = {
        "nrp_8server_bonus",
    }]]

    --[[[ 3 ] = {
        "nrp_ressurect",
    },]]

    -- Моделинг
    [ 502 ] = {
        "model_replace",
        "nrp_vehicle_configurator",
        "test_overlay",
    },
}

TESTING_RESOURCES = {
    "analytics_test",

    "ceo_recorder",
    "weapons_editor",

    "testing_stuff",
}

ROLEPLAY_RESOURCES = {
    "nrp_invite_login",
    "nrp_invite_user",
}

SERVER_NUMBER = 1

ACL_RESOURCES_ADD = {
    all = {
        "nrp_elastic",
        "nrp_invite_login",
    }
}

WEB_CONFIG = { }

function GetWebConfigValue( key )
    return WEB_CONFIG[ key ]
end

function onResourceStart_handler( )
    local admin_group = aclGetGroup( "Admin" )
    for i, v in pairs( ACL_RESOURCES_ADD ) do
        if i == "all" or i == SERVER_NUMBER then
            for n, resource_name in pairs( v ) do
                local acl_value = "resource." .. resource_name
                if not isObjectInACLGroup ( acl_value, admin_group ) then
                    aclGroupAddObject( admin_group, acl_value )
                    outputDebugString( "Добавлено в ACL: " .. acl_value, 0, 255, 255, 255 )
                end
            end
        end
    end
    
    setTimer( FetchWebConfig, 5000, 1 )
end
addEventHandler( "onResourceStart", resourceRoot, onResourceStart_handler )

function FetchWebConfig( )
    local options = {
        queueName = "server_config",
        connectionAttempts = 5,
        connectTimeout = 15000,
        method = "GET",
    }
    fetchRemote( "https://webclient.gamecluster.nextrp.ru/server_config/" .. SERVER_NUMBER, options, function( result, info )
        if info.statusCode == 200 then
            result = fromJSON( result ) or { }
            if result.status == "success" then
                WEB_CONFIG = result.data or { }
                StartResources( )
            else
                FetchWebConfig( )
            end
        else
            FetchWebConfig( )
        end
    end )
end

function StartResources( )
    local tick, count, success = getTickCount( ), 0, 0
    local function RunFrom( tbl )
        for i, v in pairs( tbl or { } ) do
            count = count + 1
            local resource = getResourceFromName( v )
            if resource then
                local result = startResource( resource, true )
                if result then
                    success = success + 1
                end
                outputDebugString( "Запуск: " .. v, 0, 255, 255, 255 )
            end
        end
    end

    RunFrom( PRE_START_RESOURCES )
    RunFrom( STARTUP_RESOURCES )
    RunFrom( SERVER_RESOURCES[ SERVER_NUMBER ] )
    if SERVER_NUMBER > 100 then 
        RunFrom( TESTING_RESOURCES )
    end
    if WEB_CONFIG.isInviteOnly then
        RunFrom( ROLEPLAY_RESOURCES )
    end

    outputDebugString( "Все ресурсы запущены: " .. success .. "/" .. count .." за " .. ( getTickCount( ) - tick ) .. " мс", 0, 255, 255, 255 )

    onStartupFinished( )
end