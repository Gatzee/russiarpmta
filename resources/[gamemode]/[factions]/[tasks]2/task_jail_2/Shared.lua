
CURRENT_AREA = nil
CURRENT_POINT = nil
PAINT_AREAS =
{
	{
		position = Vector3( -2771.25, 1992.7124, 14.1312 );
		points =
		{
			Vector3( -2771.25, 1992.7124, 14.1312 ),
			Vector3( -2769.2299, 1992.4174, 14.1312 ),
			Vector3( -2767.2099, 1992.1223, 14.1312 ),
			Vector3( -2765.1899, 1991.8273, 14.1312 ),
			Vector3( -2763.1699, 1991.5324, 14.1312 ),
			Vector3( -2761.1499, 1991.2373, 14.1312 ),
			Vector3( -2759.1298, 1990.9423, 14.1312 ),
			Vector3( -2757.1101, 1990.6474, 14.1312 ),
			Vector3( -2755.09, 1990.3522, 14.1312 ),
			Vector3( -2753.07, 1990.0573, 14.1312 ),
			Vector3( -2751.05, 1989.7624, 14.1312 ),
			Vector3( -2749.03, 1989.4672, 14.1312 ),
			Vector3( -2747.01, 1989.1723, 14.1312 ),
			Vector3( -2744.9899, 1988.8774, 14.1312 ),
			Vector3( -2742.9699, 1988.5825, 14.1312 ),
			Vector3( -2740.9499, 1988.2873, 14.1312 ),
			Vector3( -2738.9299, 1987.9924, 14.1312 ),
			Vector3( -2736.9099, 1987.6975, 14.1312 ),
			Vector3( -2734.8898, 1987.4023, 14.1312 ),
			Vector3( -2732.8701, 1987.1074, 14.1312 ),
			Vector3( -2730.85, 1986.8125, 14.1312 ),
			Vector3( -2728.83, 1986.5173, 14.1312 ),
		};
		rz = 352;
		center_point = Vector3( -2750.5771, 1990.7988, 20.1254 );
		area_size = 50;
	},

	{
		position = Vector3( -2725.4562, 1985.9016, 14.1312 );
		points =
		{
			Vector3( -2725.4562, 1985.9016, 14.1312 ),
			Vector3( -2723.4362, 1985.6066, 14.1312 ),
			Vector3( -2721.4162, 1985.3115, 14.1312 ),
			Vector3( -2719.3962, 1985.0166, 14.1312 ),
			Vector3( -2717.3762, 1984.7216, 14.1312 ),
			Vector3( -2715.3562, 1984.4265, 14.1312 ),
			Vector3( -2713.3361, 1984.1315, 14.1312 ),
			Vector3( -2711.3164, 1983.8366, 14.1312 ),
			Vector3( -2709.2963, 1983.5415, 14.1312 ),
			Vector3( -2707.2763, 1983.2465, 14.1312 ),
			Vector3( -2705.2563, 1982.9516, 14.1312 ),
			Vector3( -2703.2363, 1982.6564, 14.1312 ),
			Vector3( -2701.2163, 1982.3615, 14.1312 ),
			Vector3( -2699.1962, 1982.0666, 14.1312 ),
			Vector3( -2697.1762, 1981.7717, 14.1312 ),
			Vector3( -2695.1562, 1981.4765, 14.1312 ),
			Vector3( -2693.1362, 1981.1816, 14.1312 ),
			Vector3( -2691.1162, 1980.8867, 14.1312 ),
			Vector3( -2689.0961, 1980.5915, 14.1312 ),
		},
		rz = 350,
		center_point = Vector3( -2707.5895, 1983.3479, 20.1254 );
		area_size = 50;
	},

	{
		position = Vector3( -2685.4274, 1980.2783, 14.1312 );
		points =
		{
			Vector3( -2685.4274, 1980.2783, 14.1312 ),
			Vector3( -2683.4074, 1980.0183, 14.1312 ),
			Vector3( -2681.3874, 1979.7583, 14.1312 ),
			Vector3( -2679.3674, 1979.4982, 14.1312 ),
			Vector3( -2677.3474, 1979.2382, 14.1312 ),
			Vector3( -2675.3273, 1978.9782, 14.1312 ),
			Vector3( -2673.3073, 1978.7182, 14.1312 ),
			Vector3( -2671.2875, 1978.4582, 14.1312 ),
			Vector3( -2669.2675, 1978.1982, 14.1312 ),
			Vector3( -2667.2475, 1977.9382, 14.1312 ),
			Vector3( -2665.2275, 1977.6782, 14.1312 ),
			Vector3( -2663.2075, 1977.4182, 14.1312 ),
			Vector3( -2661.1875, 1977.1582, 14.1312 ),
			Vector3( -2659.1674, 1976.8984, 14.1312 ),
			Vector3( -2657.1474, 1976.6384, 14.1312 ),
			Vector3( -2655.1274, 1976.3784, 14.1312 ),
			Vector3( -2653.1074, 1976.1184, 14.1312 ),
			Vector3( -2651.0874, 1975.8583, 14.1312 ),
			Vector3( -2649.0673, 1975.5983, 14.1312 ),
			Vector3( -2647.0476, 1975.3383, 14.1312 ),
		},
		rz = 353,
		center_point = Vector3( -2668.4470, 1978.1350, 20.1254 );
		area_size = 50;
	},

	{
		position = Vector3( -2644.1708, 1974.9582, 14.1312 );
		points =
		{
			Vector3( -2644.1708, 1974.9582, 14.1312 ),
			Vector3( -2642.1508, 1974.6833, 14.1312 ),
			Vector3( -2640.1308, 1974.4082, 14.1312 ),
			Vector3( -2638.1108, 1974.1333, 14.1312 ),
			Vector3( -2636.0908, 1973.8581, 14.1312 ),
			Vector3( -2634.0708, 1973.5832, 14.1312 ),
			Vector3( -2632.0507, 1973.3083, 14.1312 ),
			Vector3( -2630.031, 1973.0332, 14.1312 ),
			Vector3( -2628.0109, 1972.7583, 14.1312 ),
			Vector3( -2625.9909, 1972.4831, 14.1312 ),
			Vector3( -2623.9709, 1972.2082, 14.1312 ),
			Vector3( -2621.9509, 1971.9333, 14.1312 ),
			Vector3( -2619.9309, 1971.6582, 14.1312 ),
			Vector3( -2617.9108, 1971.3833, 14.1312 ),
			Vector3( -2615.8908, 1971.1081, 14.1312 ),
			Vector3( -2613.8708, 1970.8332, 14.1312 ),
			Vector3( -2611.8508, 1970.5583, 14.1312 ),
			Vector3( -2609.8308, 1970.2832, 14.1312 ),
			Vector3( -2607.8107, 1970.0083, 14.1312 ),
			Vector3( -2605.791, 1969.7331, 14.1312 ),
		},
		rz = 352,
		center_point = Vector3( -2625.9909, 1972.4831, 20.1254 );
		area_size = 50;
	},

	{
		position = Vector3( -2602.4904, 1969.2819, 14.1312 );
		points =
		{
			Vector3( -2602.4904, 1969.2819, 14.1312 ),
			Vector3( -2600.4704, 1969.007, 14.1312 ),
			Vector3( -2598.4504, 1968.7319, 14.1312 ),
			Vector3( -2596.4304, 1968.457, 14.1312 ),
			Vector3( -2594.4104, 1968.1818, 14.1312 ),
			Vector3( -2592.3903, 1967.9069, 14.1312 ),
			Vector3( -2590.3703, 1967.632, 14.1312 ),
			Vector3( -2588.3505, 1967.3569, 14.1312 ),
			Vector3( -2586.3305, 1967.082, 14.1312 ),
			Vector3( -2584.3105, 1966.8068, 14.1312 ),
			Vector3( -2582.2905, 1966.5319, 14.1312 ),
			Vector3( -2580.2705, 1966.257, 14.1312 ),
			Vector3( -2578.2504, 1965.9819, 14.1312 ),
			Vector3( -2576.2304, 1965.707, 14.1312 ),
			Vector3( -2574.2104, 1965.4318, 14.1312 ),
			Vector3( -2572.1904, 1965.1569, 14.1312 ),
			Vector3( -2570.1704, 1964.882, 14.1312 ),
			Vector3( -2568.1503, 1964.6069, 14.1312 ),
			Vector3( -2566.1303, 1964.332, 14.1312 ),
			Vector3( -2564.1105, 1964.0568, 14.1312 ),
		},
		rz = 352,
		center_point = Vector3( -2584.3105, 1966.8068, 20.1254 );
		area_size = 50;
	},
}


QUEST_DATA = {
	id = "task_jail_2";

	title = "Маляр";
	description = "";

	replay_timeout = 0;

	tasks = {
		[1] = {
			name = "Отправляйся к своему участку";

			Setup = {
				client = function()
					CURRENT_AREA = PAINT_AREAS[ math.random(1, #PAINT_AREAS) ]
					CreateQuestPoint( CURRENT_AREA.position, "task_jail_2_end_step_1", _, 15, 0, 0, false, _, _, "cylinder" )
				end;
				server = function( player )
					player:GiveWeapon( 41, 999999, true, true )
				end;
			};
		};
		[2] = {
			name = "Покрась стену";

			Setup = {
				client = function()
					CURRENT_POINT = 1

					StartQuestTimerFail( 10 * 60 * 1000, "Покрась стену", "Слишком медленно!", function()
						triggerServerEvent( "onPlayerFailJailQuest", localPlayer, "task_jail_2" )
					end )

					CEs.PAINT_SHADER = dxCreateShader( "assets/fx/grass.fx", 0, 50, true, "world,object" )
					local pixels =  ( CURRENT_AREA.area_size * 40 )
					CEs.PAINT_RT = dxCreateRenderTarget( pixels, pixels, true )

					dxSetShaderValue( CEs.PAINT_SHADER, "tex", CEs.PAINT_RT )
					engineApplyShaderToWorldTexture( CEs.PAINT_SHADER, "turrma_map_6_1" )

					dxSetShaderValue( CEs.PAINT_SHADER, "pos", CURRENT_AREA.center_point.x, CURRENT_AREA.center_point.y, CURRENT_AREA.center_point.z )
					dxSetShaderValue( CEs.PAINT_SHADER, "mt", 0, 0, -1 )

					dxSetShaderValue( CEs.PAINT_SHADER, "rt", 0, 0, 0 )
					dxSetShaderValue( CEs.PAINT_SHADER, "scale", CURRENT_AREA.area_size )

					local texture = "assets/img/texture1.png"
					CEs.draw = function()
						dxSetRenderTarget( CEs.PAINT_RT, false )

						local px, py, pz = getPositionFromElementAtOffset( localPlayer, 0, 1, 0 )

						local pixels =  ( CURRENT_AREA.area_size * 40 )
						local tx = pixels / 2 + ( px - CURRENT_AREA.center_point.x ) * 40
						local ty = pixels / 2 + ( py - CURRENT_AREA.center_point.y ) * 40

						local size = 150
						dxDrawImage( tx - size * 3 / 2, ty - size / 2, size * 3, size, texture, 0, 0, 0, 0xFFFEFEC7 )

						dxSetRenderTarget( )

					end

					function createNextPaintPoint()
						CreateQuestPoint( CURRENT_AREA.points[ CURRENT_POINT ], function()
							CEs.marker:destroy( )

							playSoundFrontEnd( 16 )
							CEs.effect = Effect( "spraycan", localPlayer:getPosition(), Vector3( 0, 0, CURRENT_AREA.rz or 0 ), 5  )

							exports.bone_attach:attachElementToBone( CEs.effect, localPlayer, 12, 0, 0, 0, 0, 0, 0 )

							localPlayer:setPosition( CURRENT_AREA.points[ CURRENT_POINT ] )
							localPlayer:setRotation( 0, 0, CURRENT_AREA.rz or 0 )
							localPlayer:setWeaponSlot( 9 )
							localPlayer:setFrozen( true )
							localPlayer:setAnimation( "graffiti", "spraycan_fire", 1900, false, false, false, false )

							if isTimer( CEs.TIMER_NEXT_POINT ) then
								killTimer( CEs.TIMER_NEXT_POINT )
							end

							CEs.TIMER_NEXT_POINT = setTimer( function()
								CEs.effect:destroy()
								CEs.draw()
								localPlayer:setFrozen( false )
								CURRENT_POINT = CURRENT_POINT + 1
								if CURRENT_POINT > #CURRENT_AREA.points then
									triggerServerEvent( "task_jail_2_end_step_2", localPlayer )
									triggerEvent( "onClientCreateJobMarkers", localPlayer )

									triggerServerEvent( "onPlayerCompleteJailQuest", localPlayer )
								else
									createNextPaintPoint()
								end
							end, 1900, 1 )

						end, _, 1, 0, 0, false, "lalt", "Нажми левый ALT чтобы покрасить забор", "cylinder" )
					end

					createNextPaintPoint()
				end;
			};
			CleanUp =
			{
				client = function()
					localPlayer:setFrozen( false )
				end;
				server = function( player )
					player:TakeWeapon( 41 )
				end;
			}
		};
	};

	GiveReward = function( player )
		player:GiveMoney( 357, "job_salary", QUEST_DATA.id )
	end;

}
