DPS_MURDER_DATA = {
	[1] = {
		position = Vector3( -919.79999, -1816.09998, 20.8 );
		objects = {
			{
				model = 1228;
				position = Vector3( -916.59998, -1800.79999, 20.4 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1228;
				position = Vector3( -916.29999, -1806.5, 20.4 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1228;
				position = Vector3( -930.09998, -1800.70001, 20.4 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1228;
				position = Vector3( -930.09998, -1807.09998, 20.4 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1228;
				position = Vector3( -931.09998, -1813.40002, 20.4 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -916.5, -1803.70001, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -916.29999, -1809.59998, 20.1 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -916.09998, -1811.70001, 20.1 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -930.09998, -1803.79999, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -930.70001, -1810.09998, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -930.90002, -1816.59998, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -914.79999, -1814.20001, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
		};
	};
	[2] = {
		position = Vector3( -1194.6, -1726.79999, 20.8 );
		objects = {
			{
				model = 1228;
				position = Vector3( -1186, -1720.40002, 20.4 );
				rotation = Vector3( 0, 0, 90 );
			};
			{
				model = 1228;
				position = Vector3( -1183.6, -1740.40002, 20.4 );
				rotation = Vector3( 0, 0, 90 );
			};
			{
				model = 1228;
				position = Vector3( -1187.3, -1740.29999, 20.4 );
				rotation = Vector3( 0, 0, 90 );
			};
			{
				model = 1228;
				position = Vector3( -1193, -1720.09998, 20.2 );
				rotation = Vector3( 0, 0, 90 );
			};
			{
				model = 1228;
				position = Vector3( -1198.5, -1721.29999, 20.4 );
				rotation = Vector3( 0, 0, 315 );
			};
			{
				model = 1228;
				position = Vector3( -1198.7, -1739.20001, 20.4 );
				rotation = Vector3( 0, 0, 45 );
			};
			{
				model = 1228;
				position = Vector3( -1199.3, -1733.70001, 20.4 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1228;
				position = Vector3( -1199.5, -1726.70001, 20.4 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -1190.2, -1720, 20.1 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -1183.8, -1720.5, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -1195.5, -1719.90002, 20.1 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -1199.5, -1723.59998, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -1199.5, -1730.09998, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -1199.4, -1736.40002, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -1188.3, -1720.20001, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -1197, -1740.59998, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -1190.1, -1740.5, 20.1 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -1185.4, -1740.40002, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
		};
	};
	[3] = {
		position = Vector3( -899, -1536.20001, 21.1 );
		objects = {
			{
				model = 1228;
				position = Vector3( -881.40002, -1517.70001, 20.2 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1228;
				position = Vector3( -880.79999, -1508.90002, 20.5 );
				rotation = Vector3( 0, 0, 20 );
			};
			{
				model = 1228;
				position = Vector3( -884.70001, -1505, 20.4 );
				rotation = Vector3( 0, 0, 69.995 );
			};
			{
				model = 1228;
				position = Vector3( -894.5, -1504.59998, 20.4 );
				rotation = Vector3( 0, 0, 109.994 );
			};
			{
				model = 1228;
				position = Vector3( -900.5, -1507.40002, 20.4 );
				rotation = Vector3( 0, 0, 121.99 );
			};
			{
				model = 1228;
				position = Vector3( -903.09998, -1512.59998, 20.4 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1228;
				position = Vector3( -903.40002, -1518.09998, 20.2 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -877.29999, -1517.59998, 20.1 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -881.09998, -1519.09998, 20.1 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -885.59998, -1520.59998, 20.1 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -880.29999, -1510.90002, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -882.40002, -1506.70001, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -887.40002, -1504.20001, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -891.59998, -1504.09998, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -897.29999, -1506.09998, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -902.29999, -1509.70001, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -902.90002, -1515.29999, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -891.29999, -1521.29999, 20.1 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( -896.5, -1521.29999, 20.1 );
				rotation = Vector3( 0, 0, 0 );
			};
		};
	};
	[4] = {
		position = Vector3( 587.59998, -1915.4, 21 );
		objects = {
			{
				model = 1228;
				position = Vector3( 618.09998, -1913.8, 20.4 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1228;
				position = Vector3( 591.5, -1914.2, 20.4 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1228;
				position = Vector3( 591.5, -1918.8, 20.2 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1228;
				position = Vector3( 618, -1919, 20.2 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1228;
				position = Vector3( 612.90002, -1902.8, 20.4 );
				rotation = Vector3( 0, 0, 90 );
			};
			{
				model = 1228;
				position = Vector3( 608.40002, -1902.7, 20.4 );
				rotation = Vector3( 0, 0, 90 );
			};
			{
				model = 1228;
				position = Vector3( 602.29999, -1905.6, 20.4 );
				rotation = Vector3( 0, 0, 327 );
			};
			{
				model = 1238;
				position = Vector3( 618, -1911.8, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( 618, -1916.2, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( 622.70001, -1918.7, 20.1 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( 618.29999, -1921, 20.1 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( 613, -1922.5, 20.1 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( 608.40002, -1923.9, 20.1 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( 603.90002, -1924, 20.1 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( 591.59998, -1912.1, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( 591.40002, -1916.5, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( 591.5, -1921.2, 20.1 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( 600.40002, -1908.4, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( 605.20001, -1903.7, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( 610.79999, -1903, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
			{
				model = 1238;
				position = Vector3( 615.09998, -1902.9, 20.3 );
				rotation = Vector3( 0, 0, 0 );
			};
		};
	};
}

CONST_COUNT_POINTS = #DPS_MURDER_DATA


QUEST_DATA = {
	training_id = "murder_nsk";
	training_role = "dps";
	training_parent = "pps";
	
	--replay_timeout = 10800;

	title = "Расследование убийства";
	role_name = "Сотрудник ДПС";
	
	tasks = {
		[1] = {
			name = "Поговори с лейтенантом";

			Setup = {
				client = function( data )
					CreateQuestPointToNPCWithDialog( 18, {
						{
							text = [[— Здравия желаю! От ППС пришел запрос
									о необходимости отцепить место преступления.
									Бери служебный автомобиль с инвентарем и
									отправляйся расставлять ограждения.]];
						};
						{
							text = [[Тебе необходимо прибыть на место преступления,
									оградить его спец.инвентарем и не допустить
									проникновение гражданских через ограждения.]];
							info = true;
						};
						{
							text = [[Ты являешься одним из ключевых игроков
									данного учения. Если ты погибнешь или выйдешь
									из игры, то учение будет провалено!]];
							info = true;
						};
					}, "training_murder_nsk_dps_end_step_1", _, true )
				end;
			};
		};
		[2] = {
			name = "Доберись до точки";

			Setup = {
				client = function( data )
					local number = data.random_number % CONST_COUNT_POINTS + 1
					CreateQuestPoint( DPS_MURDER_DATA[ number ].position, "training_murder_nsk_dps_end_step_2", _, _, 0, 0 )
				end;
			};
		};
		[3] = {
			name = "Расставь ограждения";

			Setup = {
				client = function( data )
					addEvent( "training_murder_nsk_CreatePointToPutBarrier", true )
					addEventHandler( "training_murder_nsk_CreatePointToPutBarrier", resourceRoot, Client_CreatePointToPutBarrier )

					local number = data.random_number % CONST_COUNT_POINTS + 1
					Client_CreatePointToPutBarrier( number, 1 )
				end;

				server = function( player, data )
					addEvent( "training_murder_nsk_CreateObjectBarrier", true )
					addEventHandler( "training_murder_nsk_CreateObjectBarrier", resourceRoot, Server_CreateObjectBarrier )
				end;
			};

			CleanUp = {
				client = function( data )
					removeEventHandler( "training_murder_nsk_CreatePointToPutBarrier", resourceRoot, Client_CreatePointToPutBarrier )
				end;

				server = function( player, data )
					removeEventHandler( "training_murder_nsk_CreateObjectBarrier", resourceRoot, Server_CreateObjectBarrier )
				end;
			};
		};
		[4] = {
			name = "Убери ограждения";
			requests = {
				{ "medic", 5 };
			};

			Setup = {
				client = function( data )
					addEvent( "training_murder_nsk_CreatePointToPickupBarrier", true )
					addEventHandler( "training_murder_nsk_CreatePointToPickupBarrier", resourceRoot, Client_CreatePointToPickupBarrier )

					local number = data.random_number % CONST_COUNT_POINTS + 1
					Client_CreatePointToPickupBarrier( number, #DPS_MURDER_DATA[ number ].objects )
				end;

				server = function( player, data )
					addEvent( "training_murder_nsk_DeleteObjectBarrier", true )
					addEventHandler( "training_murder_nsk_DeleteObjectBarrier", resourceRoot, Server_DeleteObjectBarrier )
				end;
			};

			CleanUp = {
				client = function( data )
					removeEventHandler( "training_murder_nsk_CreatePointToPickupBarrier", resourceRoot, Client_CreatePointToPickupBarrier )
				end;

				server = function( player, data )
					removeEventHandler( "training_murder_nsk_DeleteObjectBarrier", resourceRoot, Server_DeleteObjectBarrier )
				end;
			};
		};
		[5] = {
			name = "Вернись на базу";

			Setup = {
				client = function( data )
					CreateQuestPoint( Vector3( 339.552, -2065.946, 20.763 ), "training_murder_nsk_dps_end_step_5", _, _, 0, 0 )
				end;
			};
		};
	};

	rewards = {
		faction_exp = 400;
	};

	success_text = "Задача выполнена! Вы получили +400 очков ранга";
}



function Client_CreatePointToPutBarrier( number, barrier_index )
	CreateQuestPoint( DPS_MURDER_DATA[ number ].objects[ barrier_index ].position, function()
		CEs.marker:destroy()
		triggerServerEvent( "training_murder_nsk_CreateObjectBarrier", resourceRoot, number, barrier_index )
	end, _, 2, 0, 0 )
end

function Server_CreateObjectBarrier( number, barrier_index )
	if not client then return end

	local barrier_info = DPS_MURDER_DATA[ number ].objects[ barrier_index ]

	local world_object = Object( barrier_info.model, barrier_info.position, barrier_info.rotation )
	world_object.frozen = true
	AddQuestElement( client, "world_object_".. barrier_index, world_object )

	setPedAnimation( client, "bomber", "bom_plant_loop", -1, false, false, false, false )

	if barrier_index == #DPS_MURDER_DATA[ number ].objects then
		triggerEvent( "training_murder_nsk_dps_end_step_3", client )
	else
		triggerClientEvent( client, "training_murder_nsk_CreatePointToPutBarrier", resourceRoot, number, barrier_index + 1 )
	end
end


function Client_CreatePointToPickupBarrier( number, barrier_index )
	CreateQuestPoint( DPS_MURDER_DATA[ number ].objects[ barrier_index ].position, function()
		CEs.marker:destroy()
		triggerServerEvent( "training_murder_nsk_DeleteObjectBarrier", resourceRoot, number, barrier_index )
	end, _, 2, 0, 0 )
end

function Server_DeleteObjectBarrier( number, barrier_index )
	if not client then return end

	DeleteQuestElement( client, "world_object_".. barrier_index )

	setPedAnimation( client, "bomber", "bom_plant_loop", -1, false, false, false, false )

	if barrier_index == 1 then
		triggerEvent( "training_murder_nsk_dps_end_step_4", client )
	else
		triggerClientEvent( client, "training_murder_nsk_CreatePointToPickupBarrier", resourceRoot, number, barrier_index - 1 )
	end
end