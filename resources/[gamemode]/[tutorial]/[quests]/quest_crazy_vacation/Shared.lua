QUEST_CONF = {
	dialogs = {
		start = {
			{ name = "Анжела", voice_line = "Angela_crazy_vacation_04", text = [[Привет, а ты шустро.
Мне тут товар принесли! Думаю нам стоит это попробовать! 
Главное думай о хорошем.]] },
		},
	},

	positions = {
		strip_club_outer = { pos = Vector3( 193.7511, -333.9621, 21.1121 ),  rot = Vector3( 0, 0, 0 ) },
		strip_club_inner = { pos = Vector3( -47.7964, -120.1919, 1372.6600 ), rot = Vector3( 0, 0, 356 ), cz = 5.6344604492188 },

		strip_club_angela_talk_matrix =  { -42.477085113525, -100.05667114258, 1373.5078125, -3.5847730636597, -10.072148323059, 1353.7550048828, 0, 70 },
		strip_club_angela_talk = { pos = Vector3( -41.9101, -98.6400, 1372.6600 ), rot = Vector3( 0, 0, 180 ) },
		strip_club_player_talk = { pos = Vector3( -41.9309, -99.3397, 1372.6600 ), rot = Vector3( 0, 0, 0 )   },

		strip_club_bots = {
			{ pos = Vector3( -47.9903, -104.0334, 1372.6600 ), rot = Vector3( 0, 0, 82 ),   anim_block = 1, anim_id = 1,  id = 7   }, --m
			{ pos = Vector3( -44.6022, -101.3310, 1372.6600 ), rot = Vector3( 0, 0, 26 ),   anim_block = 1, anim_id = 6,  id = 95  }, --m
			{ pos = Vector3( -39.9768, -103.2207, 1372.6600 ), rot = Vector3( 0, 0, 22 ),   anim_block = 1, anim_id = 6,  id = 29  }, --m
			{ pos = Vector3( -49.1080, -100.0960, 1372.6600 ), rot = Vector3( 0, 0, 196 ),  anim_block = 1, anim_id = 7,  id = 30  }, --m
			{ pos = Vector3( -48.3282, -107.0621, 1372.6600 ), rot = Vector3( 0, 0, 306 ),  anim_block = 1, anim_id = 7,  id = 160 }, --m
			{ pos = Vector3( -44.5796, -105.9119, 1372.6600 ), rot = Vector3( 0, 0, 32 ),   anim_block = 1, anim_id = 4,  id = 99  }, --f
			{ pos = Vector3( -45.9163, -103.0385, 1372.6600 ), rot = Vector3( 0, 0, 47 ),   anim_block = 1, anim_id = 6,  id = 111 }, --f
			{ pos = Vector3( -39.0070, -99.41017, 1372.6600 ), rot = Vector3( 0, 0, 131 ),  anim_block = 1, anim_id = 3,  id = 139 }, --f
			{ pos = Vector3( -49.7294, -103.8519, 1372.6600 ), rot = Vector3( 0, 0, 259 ),  anim_block = 1, anim_id = 3,  id = 73  }, --f
			{ pos = Vector3( -46.0347, -99.92134, 1372.6600 ), rot = Vector3( 0, 0, 224 ),  anim_block = 1, anim_id = 4,  id = 138 }, --f
			{ pos = Vector3( -42.7315, -103.2074, 1372.6600 ), rot = Vector3( 0, 0, 144 ),  anim_block = 1, anim_id = 1,  id = 141 }, --f
			{ pos = Vector3( -52.3151, -97.7739, 1372.6600 ),  rot = Vector3( 0, 0, 128 ),  anim_block = 2, anim_id = 10, id = 196 },
			{ pos = Vector3( -51.7238, -101.427, 1372.6600 ),  rot = Vector3( 0, 0, 76 ),   anim_block = 2, anim_id = 10, id = 197 },
			{ pos = Vector3( -65.9478, -99.6861, 1378.6712 ),  rot = Vector3( 0, 0, 271 ),  anim_block = 2, anim_id = 8,  id = 198 },
			{ pos = Vector3( -37.9800, -94.8076, 1372.6600 ),  rot = Vector3( 0, 0, 358 ),  anim_block = 2, anim_id = 12, id = 204 },
			{ pos = Vector3( -42.1605, -94.8085, 1372.6600 ),  rot = Vector3( 0, 0, 358 ),  anim_block = 2, anim_id = 8,  id = 203 },
			{ pos = Vector3( -43.5611, -94.8078, 1372.6600 ),  rot = Vector3( 0, 0, 358 ),  anim_block = 2, anim_id = 10, id = 32 },
			{ pos = Vector3( -56.7551, -105.474, 1372.6212 ),  rot = Vector3( 0, 0, 6 ),    anim_block = 4, anim_id = 14, id = 15, off_col = true },
			{ pos = Vector3( -56.0551, -105.474, 1372.8512 ),  rot = Vector3( 0, 0, 6 ),    anim_block = 4, anim_id = 15, id = 106, off_col = true },
			{ pos = Vector3( -41.4737, -93.1494, 1372.6600 ),  rot = Vector3( 0, 0, 180 ),  anim_block = 2, anim_id = 8,  id = 304, },
			{ pos = Vector3( -55.1556, -99.3254, 1373.6947 ),  rot = Vector3( 0, 0, 264 ),  anim_block = 3, anim_id = 13, id = 307, },

			{ pos = Vector3(  -54.259, -95.2947, 1372.6600 ),  rot = Vector3( 0, 0, 235 ), anim_block = 2, anim_id = 9, id = 305 },
			{ pos = Vector3( -45.6742, -91.4890,  1372.6600 ), rot = Vector3( 0, 0, 191 ), anim_block = 2, anim_id = 9, id = 305 },
			{ pos = Vector3( -65.9251, -101.0556, 1378.6712 ), rot = Vector3( 0, 0, 327 ), anim_block = 2, anim_id = 9, id = 305 },
		},

		strip_club_dance_matrix = { -35.880290985107, -108.30975341797, 1374.4793701172, -106.51538848877, -39.750801086426, 1356.8625488281, 0, 70 },
		

		strip_club_main_dance_matrix = { -50.284954071045, -99.981597900391, 1373.1734619141, -148.8083190918, -104.2720413208, 1389.7486572266, 0, 70 },
		strip_club_main_dance_positions = {
			{ pos = Vector3( -57.2534, -97.72265, 1373.6984 ), rot = Vector3( 0, 0, 255 ), id = 306, anim_block = 3, anim_id = 13, },
			{ pos = Vector3( -54.2907, -99.6089, 1373.6947 ), rot = Vector3( 0, 0, 258 ), id = 307, anim_block = 3, anim_id = 13, },
			{ pos = Vector3( -54.9748, -101.4876, 1373.6947 ), rot = Vector3( 0, 0, 259 ), id = 308, anim_block = 3, anim_id = 13, },
			{ pos = Vector3( -56.8159, -102.5389, 1373.6947 ), rot = Vector3( 0, 0, 284 ), id = 309, anim_block = 3, anim_id = 13, },
		},

		strip_club_private_dance_matrix = { -52.20885848999, -115.5336227417, 1373.7447509766, -49.349700927734, -19.814706802368, 1344.9399414063, 0, 70 },
		strip_club_private_dance_position = { pos = Vector3( -52.0661, -112.3615, 1372.6600 ), rot = Vector3( 0, 0, 182 ) },

		veh_spawn = { pos = Vector3( -183.43698120117, 504.12149047852, 20.4368019104 ), rot = Vector3( 0, 0, 1 ) },
		veh_end_route = { pos = Vector3( -368.8141, 1552.1289, 21.7584 ), rot = Vector3( 0, 0, 0 ) },

		vehicle_player_spawn = { pos = Vector3( -1257.44, 2206.64, 10.93 ), rot = Vector3( 0, 0, 0 ), cz = 45 },
		aliens_spawn =
		{
			Vector3( -1266.12, 2141.91, 10.92 ),
			Vector3( -1279.8, 2155.8, 10.92 ),
			Vector3( -1295.63, 2171.56, 10.92 ),
			Vector3( -1308.62, 2184.89, 10.93 ),
			Vector3( -1320.4, 2195.67, 10.93 ),
			Vector3( -1310.89, 2204.8, 10.92 ),
			Vector3( -1298.36, 2216.73, 10.93 ),
			Vector3( -1285.01, 2229.95, 10.93 ),
			Vector3( -1273.68, 2241.14, 10.92 ),
			Vector3( -1261.81, 2253.82, 10.93 ),
			Vector3( -1249.94, 2265.32, 10.93 ),
			Vector3( -1239.18, 2254.09, 10.93 ),
			Vector3( -1230.92, 2245.47, 10.93 ),
			Vector3( -1222.88, 2236.98, 10.92 ),
			Vector3( -1211.61, 2225.21, 10.93 ),
		},

		spawn_clouds_player = { pos = Vector3( 675.7824, 2592.3666, 476.0250 ), rot = Vector3( 0, 0, 104 ), cz = 100 },
		spawn_clouds_angela = { pos = Vector3( 675.0302, 2593.8364, 476.0250 ), rot = Vector3( 0, 0, 103 ) },

		landing_point = { pos = Vector3( 172.85, 2493.01, 20.41 ), },

		finish_point = { pos = Vector3( 205.57, -350.41, 20.89 ), rot = Vector3( 0, 0, 0 ), cz = 90 },
		finish_matrix = { 210.18049621582, -354.03277587891, 22.508386611938, 134.71319580078, -292.798828125, -1.0519914627075, 0, 70 },

		restore_fail_mission = { pos = Vector3( 187.16, -326.02, 20.07 ), rot = Vector3( 0, 0, 122 ) },
	},

	vehicle_id = 6612
}

GEs = { }

QUEST_DATA = {
	id = "crazy_vacation",
	is_company_quest = true,

	title = "Сумасшедший отдых",
	description = "После такого забыться мне, точно не помешает!",

	CheckToStart = function( player )
		if player.interior ~= 0 or player.dimension ~= 0 then return end
		return true
	end,

	restart_position = Vector3( 185.8861, -310.6238, 20.7010 ),

	quests_request = { "murderous_setup" },
	level_request = 18,

	OnAnyFinish = {
		client = function()
			DestroyBlurEffect()
			setCameraShakeLevel( 0 )
			toggleAllControls( true )

			if CEs.stripes then FinishQuestCutscene( { ignore_fade_blink = true } ) end
			fadeCamera( true, 1 )
			triggerEvent( "SwitchRadioEnabled", root, true )
		end,
		server = function( player )
            player:TakeAllWeapons( true )

			if (player.interior ~= 0 and player.dimension == player:GetUniqueDimension()) or player:getData( "parachute_scene" ) then
				player.interior = 0
				player:setData( "parachute_scene", false, false )
				player.position = QUEST_CONF.positions.restore_fail_mission.pos:AddRandomRange( 3 )
				player.rotation = QUEST_CONF.positions.restore_fail_mission.rot
			end

			DestroyAllTemporaryVehicles( player )
			ExitLocalDimension( player )
		end,
	},

	tasks = {

		{
			name = "Отправляйся в стрип-клуб",

			Setup = {
				client = function( )
					local positions = QUEST_CONF.positions
					CreateQuestPoint( positions.strip_club_outer.pos, function( self, player )
						CEs.marker.destroy( )

						fadeCamera( false, 0.5 )
						CEs.end_tmr = setTimer( function()
							EnterLocalDimension()
							triggerServerEvent( "crazy_vacation_step_1", localPlayer )
						end, 500, 1 ) 
					end, _, 1 )
				end,

				server = function( player )
				end
			},

			event_end_name = "crazy_vacation_step_1",
		},

		{
			name = "Поговори с Анжелой",
	
			Setup = {
				client = function( )
					toggleControl( "fire", false )

					local positions = QUEST_CONF.positions

					localPlayer.position = positions.strip_club_inner.pos
					localPlayer.rotation = positions.strip_club_inner.rot
					localPlayer.interior = 1
					setPedCameraRotation( localPlayer, positions.strip_club_inner.cz )

					GEs.angela_bot = CreateAIPed( FindQuestNPC( "angela_rublevo_near_house" ).model, positions.strip_club_angela_talk.pos, positions.strip_club_angela_talk.rot.z )
					LocalizeQuestElement( GEs.angela_bot )
					GEs.angela_bot.interior = 1

					CEs.CreateStripClubContent = function()
						local anim_block = { "dancing", "playidles", "strip_club.dances", "misc" }
						local dance_animation = { "dance_loop", "dan_down_a", "dan_loop_a", "dan_up_a", "dnce_m_a", "dnce_m_b", "dnce_m_d", "strleg", "shift", "shldr", "stretch", "time", "private", "seat_lr", "seat_talk_02" }
						
						SetUndamagable( GEs.angela_bot, true )
						setPedAnimation( GEs.angela_bot, "dancing", "dnce_m_b", -1, true, false )
	
						GEs.strip_club_content = {}
						for k, v in pairs( positions.strip_club_bots ) do
							GEs.strip_club_content[ v.id ] = createPed( v.id, v.pos, v.rot.z )
							LocalizeQuestElement( GEs.strip_club_content[ v.id ] )
							GEs.strip_club_content[ v.id ].interior = 1
							
							SetUndamagable( GEs.strip_club_content[ v.id ], true )

							if v.anim_id then setPedAnimation( GEs.strip_club_content[ v.id ], anim_block[ v.anim_block or 1 ], dance_animation[ v.anim_id ], -1, true, false ) end
							if v.off_col then setElementCollisionsEnabled( GEs.strip_club_content[ v.id ], false ) end
						end
	
						GEs.strip_club_content[ "wa_smoke"] = createPed( 305, Vector3( -28.3062, -109.1249, 1372.6600), 90 )
						SetUndamagable(GEs.strip_club_content[ "wa_smoke"], true )
						LocalizeQuestElement( GEs.strip_club_content[ "wa_smoke"] )
						
						GEs.strip_club_content[ "wa_smoke"].interior = 1
						GEs.strip_club_content[ "wa_smoke"]:setAnimation( "shop", "smoke_ryd", -1, true, false, false, false )
		
						GEs.strip_club_content[ "wa_smoke_ef" ] = createEffect( "cigarette_smoke", -28.3062, -109.1249, 1372.6600 )
						GEs.strip_club_content[ "wa_smoke_obj" ] = createObject( 3027, -28.3062, -109.1249, 1372.6600 )
						
						exports.bone_attach:attachElementToBone( GEs.strip_club_content[ "wa_smoke_obj" ], GEs.strip_club_content[ "wa_smoke"], 11, 0.01, 0.05, 0.11, 95, 0, 0 )
						exports.bone_attach:attachElementToBone( GEs.strip_club_content[ "wa_smoke_ef" ], GEs.strip_club_content[ "wa_smoke"], 11, 0.01, -0.05, 0.11, 95, 0, 0 )
	
						LocalizeQuestElement( GEs.strip_club_content[ "wa_smoke_ef"] )
						GEs.strip_club_content[ "wa_smoke_ef" ].interior = 1

						LocalizeQuestElement( GEs.strip_club_content[ "wa_smoke_obj"] )
						GEs.strip_club_content[ "wa_smoke_obj" ].interior = 1
						
						GEs.strip_club_content[ "shader_tv" ], GEs.strip_club_content[ "texture" ] = CreateReplaceShader( ":nrp_strip_club/files/img/bg_tv.png", "white_tv" )
						
						GEs.background_sound = playSound( ":nrp_strip_club/files/sfx/music_striptease_2.ogg", true )
						GEs.background_sound.volume = 0.3
						
						
						CreateQuestPoint( positions.strip_club_player_talk.pos, function( self, player )
							CEs.marker.destroy( )
							
							GEs.background_sound.volume = 0.08
							StartQuestCutscene( { dialog = QUEST_CONF.dialogs.start } )
							setCameraMatrix( unpack( positions.strip_club_angela_talk_matrix ) )
	
							localPlayer.position = positions.strip_club_player_talk.pos
							localPlayer.rotation = positions.strip_club_player_talk.rot
	
							StartPedTalk( GEs.angela_bot, nil, true )
							CEs.dialog:next( )
	
							setTimerDialog( function()
								StopPedTalk( GEs.angela_bot )
								GEs.background_sound.volume = 0.15
								triggerServerEvent( "crazy_vacation_step_2", localPlayer )
							end, 8200 )
						end, _, 1, 1 )

						fadeCamera( true, 0.5 )
					end

					CEs.create_content_tmr = setTimer( CEs.CreateStripClubContent, 2500, 1 )
				end,
				server = function( player )
					player.interior = 1
				end,
			},

			CleanUp = {
				client = function( )
					FinishQuestCutscene( )
				end,
			},
	
			event_end_name = "crazy_vacation_step_2",
		},

		{
			name = "Используй хэш",

			Setup = {
				client = function( )
					local positions = QUEST_CONF.positions

					CEs.hint = CreateSutiationalHint( {
						text = "Нажми key=Q чтобы открыть инвентарь",
						condition = function( ) return true end
					} )

					CEs.KeyHandler = function( key, state )
						if key == "q" and state then
							CEs.hint:destroy()
							removeEventHandler( "onClientKey", root, CEs.KeyHandler )
						end
					end
					addEventHandler( "onClientKey", root, CEs.KeyHandler )
					
					CEs.onClientPlayerUseDrugs = function( drugs_num )
						removeEventHandler( "onClientQuestPlayerUseDrugs", localPlayer, CEs.onClientPlayerUseDrugs )

						fadeCamera( false, 1 )
						CEs.ending_tmr = setTimer( function()
							triggerServerEvent( "crazy_vacation_step_3", localPlayer )
						end, 1000, 1 )
					end
					addEventHandler( "onClientQuestPlayerUseDrugs", localPlayer, CEs.onClientPlayerUseDrugs )

					BlockAllKeys( { "q" })
					toggleAllControls( false )
					setCameraMatrix( unpack( positions.strip_club_angela_talk_matrix ) )
				end,

				server = function( player )				
					player:InventoryAddTempItem( IN_TUTORIAL_HASH )
				end
			},

			CleanUp = {
				client = function( )
					UnblockAllKeys()
					toggleAllControls( true )
					removeEventHandler( "onClientKey", root, CEs.KeyHandler )
					removeEventHandler( "onClientQuestPlayerUseDrugs", localPlayer, CEs.onClientPlayerUseDrugs )
				end,
				server = function( player )
					player:InventoryRemoveTempItem( IN_TUTORIAL_HASH )
				end,
			},

			event_end_name = "crazy_vacation_step_3",
		},

		{
			name = "Танцы...",

			Setup = {
				client = function( )
					destroyElement( GEs.strip_club_content[ 307 ] )

					local positions = QUEST_CONF.positions

					CreateBlurEffect()
					setCameraShakeLevel( 80 )
					setGameSpeed( 0.99 )
								
					local anim_block = { "dancing", "playidles", "strip_club.dances", "misc" }
					local dance_animation = { "dance_loop", "dan_down_a", "dan_loop_a", "dan_up_a", "dnce_m_a", "dnce_m_b", "dnce_m_d", "strleg", "shift", "shldr", "stretch", "time", "private", "seat_lr", "seat_talk_02" }
								
					for k, v in pairs( positions.strip_club_main_dance_positions ) do
						GEs.strip_club_content[ v.id ] = createPed( v.id, v.pos, v.rot.z )
						LocalizeQuestElement( GEs.strip_club_content[ v.id ] )
						setPedAnimation( GEs.strip_club_content[ v.id ], anim_block[ v.anim_block or 1 ], dance_animation[ v.anim_id ], -1, true, false )
					end
				
					CEs.show_screen_tmr = setTimer( function()
						StartQuestCutscene()
						setCameraMatrix( unpack( positions.strip_club_main_dance_matrix ) )		
					end, 150, 1 )
				
					CEs.change_scene_tmr = setTimer( function()
						fadeCamera( false, 1 )
						CEs.on_fade_tmr = setTimer( function()
							setCameraMatrix( unpack( positions.strip_club_private_dance_matrix ) )
							
							GEs.strip_club_content[ "private_bot" ] = createPed( 306, positions.strip_club_private_dance_position.pos, positions.strip_club_private_dance_position.pos.z )
							LocalizeQuestElement( GEs.strip_club_content[ "private_bot" ] )
							setPedAnimation( GEs.strip_club_content[ "private_bot" ], "strip_club.dances", "private", -1, true, false )
						
							fadeCamera( true, 1 )
						end, 1000, 1 )
					end, 5000, 1 )
				
					CEs.ending_tmr = setTimer( function()
						fadeCamera( false, 0.5 )
						CEs.fade_camera_tmr = setTimer( function()
							triggerEvent( "SwitchRadioEnabled", root, false )
							triggerServerEvent( "crazy_vacation_step_4", localPlayer )
						end, 500, 1 )
					end, 16000, 1 )
				end,

				server = function( player )
					local vehicle = CreateTemporaryVehicle( player, 6537, QUEST_CONF.positions.veh_spawn.pos, QUEST_CONF.positions.veh_spawn.rot )
					vehicle:SetNumberPlate( "1:o746oo178" )
					vehicle:SetColor( 255, 0, 0 )					

					player:SetPrivateData( "temp_vehicle", vehicle )
				end
			},

			CleanUp = {
				client = function( )
					DestroyTableElements( GEs.strip_club_content )
					FinishQuestCutscene( { ignore_fade_blink = true } )
				end,
			},

			event_end_name = "crazy_vacation_step_4",
		},

		{
			name = "Не разбей машину",

			Setup = {
				client = function( )
					DisableHUD( true )
					toggleControl( "enter_exit", false )
					
					local positions = QUEST_CONF.positions

					local temp_vehicle = localPlayer:getData( "temp_vehicle" )

					table.insert( CEs, WatchElementCondition( temp_vehicle, {
						condition = function( self, conf )
							if self.element.health <= 370 or self.element.inWater then
								FailCurrentQuest( "Машина Анжелы уничтожена!", "fail_destroy_vehicle" )
								return true
							elseif self.element:GetFuel( ) <= 0 then
								FailCurrentQuest( "Закончилось топливо!" )
								return true
							end
						end,
					} ) )

					warpPedIntoVehicle( GEs.angela_bot, temp_vehicle, 1 )
					GEs.angela_bot.interior = 0

					setCameraFieldOfView ( "vehicle", 60 )
					setCameraShakeLevel( 200 )
					setSkyGradient( math.random( 255 ), math.random( 50 ), math.random( 50 ), math.random( 255 ), math.random( 50 ), math.random( 50 ) )

					setPedControlState( localPlayer, "accelerate", true )

					CEs.show_screen = setTimer( function()
						CreateQuestPoint( positions.veh_end_route.pos, function( self, player )
							CEs.marker.destroy( )
							fadeCamera( false, 1 )
							CEs.ending_tmr = setTimer( function()
								triggerServerEvent( "crazy_vacation_step_5", localPlayer )
							end, 1000, 1 )
						end, _, 25 )
						CEs.marker.slowdown_coefficient = nil

						fadeCamera( true, 2 )
						CEs.enable_drunk_controls_tmr = setTimer( function()
							EnableDrunkControls()
							DisableHUD( false )
							setPedControlState( localPlayer, "accelerate", false )
						end, 1700, 1 )
					end, 2000, 1 )
				end,

				server = function( player )
					player.interior = 0
					warpPedIntoVehicle( player, player:getData( "temp_vehicle" ) )
				end
			},

			CleanUp = 
			{
				client = function()
					setGameSpeed( 1 )
					DisableHUD( false )
					setCameraFieldOfView( "vehicle", 70 )
				end,
				server = function( player )
					removePedFromVehicle( player )
				end,
			},

			event_end_name = "crazy_vacation_step_5",
		},

		{
			name = "Отбей нападение инопланетян",

			Setup = {
				client = function( )
					EnableCheckQuestDimension( true )
					
					local positions = QUEST_CONF.positions

					CEs.dummy_veh = createVehicle( 6537, positions.vehicle_player_spawn.pos, positions.vehicle_player_spawn.rot )
					CEs.dummy_veh:SetNumberPlate( "1:o746oo178" )
					CEs.dummy_veh:SetColor( 255, 0, 0 )
					CEs.dummy_veh.frozen = true
					setElementData( CEs.dummy_veh, "bStatic", true, false )

					LocalizeQuestElement( CEs.dummy_veh )

					SetStateMoveControls( false )
					localPlayer.position = positions.vehicle_player_spawn.pos + Vector3( 0, 0, 1 )
					localPlayer.rotation = positions.vehicle_player_spawn.rot
					setCameraTarget( localPlayer, localPlayer )
					setPedCameraRotation( localPlayer, positions.vehicle_player_spawn.cz )
					
					setCameraShakeLevel( 80 )

					CEs.effects = {}

					local radius = 30
					local count_steps = 360 / 10
					local step = math.pi * 2 / count_steps
					for i = 1, count_steps do
						local x, y, z =  math.cos ( i * step ) * radius, math.sin ( i * step ) * radius, 0
						CEs.effects[ i ] = createEffect( "prt_smoke_huge", positions.vehicle_player_spawn.pos + Vector3( x, y, z ), Vector3( 0, 0, 0 ), 8191, true )
					end
					
					CEs.slow_effects_tmr = setTimer( function()
						for i = 1, count_steps do
							setEffectSpeed( CEs.effects[ i ], 0 )
						end
					end, 4000, 1 )

					GEs.change_strength_blur( 0, 3 )
					CEs.shader, CEs.texture = CreateReplaceShader( "img/green_smoke_texture.png", "newfx1" )

					CEs.alien_bots = {}
					CEs.alien_bots_follows = {} 
					CEs.CreateAlienBot = function( id )
						local alien_bot = CreateAIPed( 100, positions.aliens_spawn[ id ] )
						alien_bot.health = 5
					
						CEs.alien_bots_follows[ alien_bot ] = CreatePedFollow( alien_bot )
						CEs.alien_bots_follows[ alien_bot ].move_type = 4
						CEs.alien_bots_follows[ alien_bot ]:start( localPlayer )
					
						table.insert( CEs.alien_bots, alien_bot )
					
						addEventHandler( "onClientPedWasted", alien_bot, function()
							CEs.alien_bots_follows[ alien_bot ]:destroy()
							alien_bot.position = alien_bot.position
							alien_bot:setAnimation( "wuzi", "cs_dead_guy" )
							CEs.CreateAlienBot( id )
						end )
					
						return alien_bot
					end

					for i = 1, #positions.aliens_spawn do
						CEs.CreateAlienBot( i )
					end
					CEs.show_screen_tmr = setTimer( fadeCamera, 1000, 1, true, 1 )

					StartQuestTimerWait( 60000, "Отбей нападение инопланетян", _, _, function()
						fadeCamera( false, 1 )
						CEs.ending_tmr = setTimer( function()
							triggerServerEvent( "crazy_vacation_step_6", localPlayer )
						end, 1000, 1 )
						
						return true
					end )
				end,

				server = function( player )
					player:GiveWeapon( 31, 9999, true, true, "quest_crazy_vacation" )
				end
			},

			CleanUp = 
			{
				client = function()
					SetStateMoveControls( true )
				end,
				server = function()
					player:TakeAllWeapons( true )
				end,
			},

			event_end_name = "crazy_vacation_step_6",
		},

		{
			name = "Прыгай за Анжелой",

			Setup = {
				client = function( )
					local positions = QUEST_CONF.positions

					localPlayer.position = positions.spawn_clouds_player.pos
					localPlayer.rotation = positions.spawn_clouds_player.rot
					setCameraTarget( localPlayer, localPlayer )

					setPedCameraRotation( localPlayer, positions.spawn_clouds_player.cz )
					GEs.change_strength_blur( 0, 5 )
					setCameraShakeLevel( 160 )
					fadeCamera( true, 1 )

					removePedFromVehicle( GEs.angela_bot )
					givePedWeapon( GEs.angela_bot, 46, 1, true )

					GEs.angela_bot.position = positions.spawn_clouds_angela.pos
					GEs.angela_bot.rotation = positions.spawn_clouds_angela.rot
					GEs.angela_bot.frozen = true
					
					CEs.jump_tmr = setTimer( function()
						GEs.angela_bot.frozen = false
						setPedControlState( GEs.angela_bot, "jump", true )
					end, 1000, 1 )
					
					GEs.off_jump_control_tmr = setTimer( function()
						setPedControlState( GEs.angela_bot, "jump", false )
						setPedAnimation( GEs.angela_bot, "parachute", "fall_skydive_accel", -1, true, false, false, false, 250, false )
					end, 1200, 1 )
				
					GEs.open_parachute_angela_bot = setTimer( triggerEvent, 2000, 1, "doAddParachuteToPlayer", GEs.angela_bot )
					GEs.rotate_left_tmr = setTimer( function()
						setPedControlState( GEs.angela_bot, "left", true )
						GEs.end_rotate_tmr = setTimer( function()
							setPedControlState( GEs.angela_bot, "left", false )
						end, 7200, 1 )

						GEs.rotate_right_tmr = setTimer( function()
							setPedControlState( GEs.angela_bot, "right", true )
							setPedControlState( GEs.angela_bot, "backwards", true )
							GEs.end_rotate_tmr = setTimer( function()
								setPedControlState( GEs.angela_bot, "right", false )
								setPedControlState( GEs.angela_bot, "backwards", false )
							end, 7200, 1 )
						end, 30800, 1 )
					end, 15000, 1 )
					
					GEs.check_pos_tmr = setTimer( function()
						if (localPlayer.position - positions.spawn_clouds_player.pos).length > 5 then
							killTimer( GEs.check_pos_tmr )
							triggerServerEvent( "crazy_vacation_step_7", localPlayer )
						end
					end, 1000, 0 )
				end,

				server = function( player )
					player:TakeAllWeapons( true )
					player:setData( "parachute_scene", true, false )
					player:GiveWeapon( 46, 1, true, true, "quest_crazy_vacation_parachute" )
				end
			},

			event_end_name = "crazy_vacation_step_7",
		},

		{
			name = "Красная площадь ждёт",

			Setup = {
				client = function( )
					local positions = QUEST_CONF.positions

					CreateQuestPoint( positions.landing_point.pos, function( self, player )
						CEs.marker.destroy( )
						fadeCamera( false, 1 )

						CEs.ending_tmr = setTimer( function()
							triggerServerEvent( "crazy_vacation_step_8", localPlayer )
						end, 1000, 1 )
					end, _, 45 )
					CEs.marker.slowdown_coefficient = nil
				end,
			},

			CleanUp = 
			{
				client = function()
					DestroyBlurEffect()
					setCameraShakeLevel( 0 )
				end,
				server = function( player )
					player:TakeAllWeapons( true )
				end,
			},

			event_end_name = "crazy_vacation_step_8",
		},

		{
			name = "...",

			Setup = {
				client = function( )
					GEs.background_sound.volume = 0
					
					DisableHUD( true )
					fadeCamera( false, 0 )
					
					local positions = QUEST_CONF.positions
					
					localPlayer.position = positions.finish_point.pos
					localPlayer.rotation = positions.finish_point.rot

					CEs.set_anim_tmr = setTimer( function()
						setCameraShakeLevel( 0 )
						localPlayer:setAnimation( "sunbathe", "sbathe_f_lieb2sit", -1, false, false, false, true )

						CEs.show_screen_tmr = setTimer( function()	
							setCameraMatrix( unpack( positions.finish_matrix ) )
							StartQuestCutscene()
							localPlayer:setAnimation( "sunbathe", "sbathe_f_lieb2sit", -1, false, false, false, true )

							CEs.change_anim_tmr = setTimer( function()
								localPlayer:setAnimation( "sunbathe", "sbathe_f_out", -1, false, false, false, false )
							end, 1700, 1 )

							CEs.ending_tmr = setTimer( function()
								FinishQuestCutscene()
								triggerServerEvent( "crazy_vacation_step_9", localPlayer )
							end, 3800, 1 )
						end, 3800, 1 )
					end, 1050, 1 )
				end,

				server = function( player )
					player:setData( "parachute_scene", false, false )
				end
			},

			CleanUp = 
			{
				client = function()
					DisableHUD( false )
					FinishQuestCutscene()
				end
			},

			event_end_name = "crazy_vacation_step_9",
		},
	},

	GiveReward = function( player )
		SendQuest24Invite( player )
		triggerClientEvent( player, "ShowPlayerUIQuestCompleted", player, 
		{
			rewards = { money = QUEST_DATA.rewards.money, exp = QUEST_DATA.rewards.exp, premium = 3 }
		} )
		player:GivePremiumExpirationTime( 3, "quest_unconscious_betrayal" )
	end,

	rewards = {
		money = 6500,
		exp = 5500,
		premium = 3,
	},

	no_show_rewards = true,
}