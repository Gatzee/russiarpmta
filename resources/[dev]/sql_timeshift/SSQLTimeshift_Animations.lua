DANCES_LIST = 
{
	{ 
		name = "Мыть руки",
		cost = 18750,
		level = 1,
		anim_data = { "bd_fire", "wash_up" },
		is_looped = true,
		rarity = 1,
		icon = 3,
	},

	{ 
		name = "Отдых 1",
		cost = 18750,
		level = 1,
		anim_data = { "beach", "bather" },
		is_looped = true,
		rarity = 1,
		icon = 4,
	},

	{ 
		name = "Отдых 2",
		cost = 25000,
		level = 1,
		anim_data = { "beach", "lay_bac_loop" },
		is_looped = true,
		rarity = 1,
		icon = 4,
	},

	{ 
		name = "Отдых 3",
		cost = 31250,
		level = 1,
		anim_data = { "beach", "parksit_m_loop" },
		is_looped = true,
		rarity = 2,
		icon = 6,
	},

	{ 
		name = "Отдых 4",
		cost = 46875,
		level = 1,
		anim_data = { "beach", "parksit_w_loop" },
		is_looped = true,
		rarity = 3,
		icon = 7,

	},

	{ 
		name = "Отдых 5",
		cost = 62500,
		level = 1,
		anim_data = { "beach", "sitnwait_loop_w" },
		is_looped = true,
		rarity = 3,
		icon = 7,
	},

	{ 
		name = "Шнурки",
		cost = 31250,
		level = 1,
		anim_data = { "bomber", "bom_plant" },
		rarity = 2,
		icon = 9,
	},

	{ 
		name = "Подозвать",
		cost = 18750,
		level = 1,
		anim_data = { "camera", "camstnd_cmon" },
		rarity = 1,
		icon = 10,
	},

	{ 
		name = "Победа 1",
		cost = 31250,
		level = 1,
		anim_data = { "casino", "manwind" },
		rarity = 2,
		icon = 11,
		rz = 180,
	},

	{ 
		name = "Победа 2",
		cost = 62500,
		level = 1,
		anim_data = { "casino", "manwinb" },
		rarity = 3,
		icon = 12,
		rz = 180,
	},

	{ 
		name = "Время",
		cost = 31250,
		level = 1,
		anim_data = { "cop_ambient", "coplook_watch" },
		rarity = 2,
		icon = 13,
	},

	{ 
		name = "Задумчивость",
		cost = 62500,
		level = 1,
		anim_data = { "cop_ambient", "coplook_think" },
		is_looped = true,
		rarity = 3,
		icon = 14,
	},

	{ 
		name = "Руки на пояс",
		cost = 31250,
		level = 1,
		anim_data = { "cop_ambient", "coplook_shake" },
		is_looped = true,
		rarity = 2,
		icon = 15,
	},

	{ 
		name = "Руки на грудь",
		cost = 46875,
		level = 1,
		anim_data = { "cop_ambient", "coplook_loop" },
		is_looped = true,
		rarity = 2,
		icon = 16,
	},

	{ 
		name = "Усталость 1",
		cost = 18750,
		level = 1,
		anim_data = { "crack", "crckidle1" },
		is_looped = true,
		rarity = 2,
		icon = 17,
	},

	{ 
		name = "Усталость 2",
		cost = 31250,
		level = 1,
		anim_data = { "crack", "crckidle2" },
		is_looped = true,
		rarity = 2,
		icon = 17,
	},

	{ 
		name = "Усталость 3",
		cost = 62500,
		level = 1,
		anim_data = { "crack", "crckidle3" },
		is_looped = true,
		rarity = 3,
		icon = 18,
	},

	{ 
		name = "Усталость 4",
		cost = 62500,
		level = 1,
		anim_data = { "crack", "crckidle4" },
		is_looped = true,
		rarity = 3,
		icon = 18,
	},

	{ 
		name = "Скрестить руки",
		cost = 62500,
		level = 1,
		anim_data = { "dealer", "dealer_idle" },
		is_looped = true,
		rarity = 3,
		icon = 19,
	},

	{ 
		name = "Помахать рукой",
		cost = 18500,
		level = 1,
		anim_data = { "ghands", "gsign2lh" },
		rarity = 1,
		icon = 20,
	},

	{ 
		name = "Попутка",
		cost = 18500,
		level = 1,
		anim_data = { "misc", "hiker_pose" },
		rarity = 1,
		icon = 21,
	},

	{ 
		name = "Помахать рукой",
		cost = 31250,
		level = 1,
		anim_data = { "on_lookers", "wave_loop" },
		rarity = 2,
		icon = 22,
	},

	{ 
		name = "Указать",
		cost = 18750,
		level = 1,
		anim_data = { "on_lookers", "point_loop" },
		is_looped = true,
		rarity = 1,
		icon = 23,
	},

	{ 
		name = "Facepalm",
		cost = 78125,
		level = 1,
		anim_data = { "otb", "wtchrace_lose" },
		rarity = 3,
		icon = 24,
	},

	{ 
		name = "Руки за голову",
		cost = 0,
		level = 1,
		anim_data = { "ped", "cower" },
		is_looped = true,
		rarity = 2,
		icon = 25,
	},

	{ 
		name = "Руки вверх",
		cost = 0,
		level = 1,
		anim_data = { "ped", "handsup" },
		freeze_lf = true,
		rarity = 2,
		icon = 26,
	},

	{ 
		name = "Ну давай!",
		cost = 62500,
		level = 1,
		anim_data = { "riot", "riot_angry" },
		rarity = 3,
		icon = 27,
	},

	-- Dances
	{ 
		name = "Танец 1",
		cost = 100000,
		level = 3,
		anim_data = { "dancing", "dance_loop" },
		is_looped = true,
		rarity = 1,
		icon = 28,
	},

	{ 
		name = "Танец 2",
		cost = 300000,
		level = 5,
		anim_data = { "CUSTOM_BLOCK_1", "crckidle1" },
		is_looped = true,
		rarity = 2,
		icon = 29,
		rz = 180,
	},

	{ 
		name = "Танец 3",
		cost = 400000,
		level = 6,
		anim_data = { "CUSTOM_BLOCK_1", "crckidle2" },
		is_looped = true,
		rarity = 2,
		icon = 29,
		rz = 180,
	},

	{ 
		name = "Танец 4",
		cost = 400000,
		level = 6,
		anim_data = { "CUSTOM_BLOCK_1", "crckidle3" },
		is_looped = true,
		rarity = 2,
		icon = 29,
		rz = 180,
	},

	{ 
		name = "Танец 5",
		cost = 1200000,
		level = 11,
		anim_data = { "CUSTOM_BLOCK_1", "crckidle4" },
		is_looped = true,
		rarity = 3,
		icon = 32,
		rz = 180,
	},

	{ 
		name = "Танец 6",
		cost = 800000,
		level = 8,
		anim_data = { "CUSTOM_BLOCK_1", "crckdeth1" },
		is_looped = true,
		rarity = 3,
		icon = 32,
		rz = 180,
	},

	{ 
		name = "Танец 7",
		cost = 500000,
		level = 7,
		anim_data = { "CUSTOM_BLOCK_1", "crckdeth2" },
		is_looped = true,
		rarity = 2,
		icon = 29,
		rz = 180,
	},

	{ 
		name = "Танец 8",
		cost = 1000000,
		level = 10,
		anim_data = { "CUSTOM_BLOCK_1", "crckdeth3" },
		is_looped = true,
		rarity = 3,
		icon = 33,
		rz = 180,
	},

	{ 
		name = "Танец 9",
		cost = 900000,
		level = 9,
		anim_data = { "CUSTOM_BLOCK_1", "crckdeth4" },
		is_looped = true,
		rarity = 3,
		icon = 33,
		rz = 180,
	},

	{ 
		name = "Танец 10",
		cost = 200000,
		level = 4,
		anim_data = { "CUSTOM_BLOCK_2", "dnce_M_c" },
		is_looped = true,
		rarity = 1,
		icon = 28,
	},

	{ 
		name = "Танец 11",
		cost = 100000,
		level = 3,
		anim_data = { "CUSTOM_BLOCK_2", "dnce_M_d" },
		is_looped = true,
		rarity = 1,
		icon = 28,
	},

	{ 
		name = "Танец 12",
		cost = 1500000,
		level = 12,
		anim_data = { "CUSTOM_BLOCK_3", "dnce_M_a" },
		is_looped = true,
		rarity = 3,
		icon = 31,
	},

	{ 
		name = "Танец 13",
		cost = 1200000,
		level = 11,
		anim_data = { "CUSTOM_BLOCK_3", "dnce_M_b" },
		is_looped = true,
		rarity = 3,
		icon = 32,
	},

	{ 
		name = "Танец 14",
		cost = 300000,
		level = 5,
		anim_data = { "CUSTOM_BLOCK_3", "dnce_M_c" },
		is_looped = true,
		rarity = 2,
		icon = 30,
	},

	{ 
		name = "Танец 15",
		cost = 1000000,
		level = 10,
		anim_data = { "CUSTOM_BLOCK_3", "dnce_M_d" },
		is_looped = true,
		rarity = 3,
		icon = 33,
	},

	{ 
		name = "Танец 16",
		cost = 900000,
		level = 9,
		anim_data = { "CUSTOM_BLOCK_3", "dnce_M_e" },
		is_looped = true,
		rarity = 3,
		icon = 33,
	},
}

RESTORED_ANIMATIONS = { }
NICKNAMES = { }

TestDB:queryAsync( 
    function( query )
        local rows = query:poll( -1 )

        local n = 0
        for row_num, data in pairs( rows ) do
            local id = data.id
            local permanent_data = fromJSON( data.permanent_data )

            -- Только тем, у кого были анимации
            if permanent_data and permanent_data.unlocked_animations then
                n = n + 1
                DB:queryAsync( 
                    function( query, id, nickname, animations )
                        local result = query:poll( -1 )
                        local permanent_data = fromJSON( result[ 1 ].permanent_data ) or { }

                        permanent_data.unlocked_animations = permanent_data.unlocked_animations or { }
                        for i, v in pairs( animations ) do
                            if not permanent_data.unlocked_animations[ tostring( i ) ] then
                                permanent_data.unlocked_animations[ tonumber( i ) ] = v
                                if not RESTORED_ANIMATIONS[ id ] then RESTORED_ANIMATIONS[ id ] = { } end
                                NICKNAMES[ id ] = nickname
                                table.insert( RESTORED_ANIMATIONS[ id ], DANCES_LIST[ tonumber( i ) ].name )
                            end
                        end
                    
                        permanent_data = toJSON( permanent_data, true )

                        DB:queryAsync( function( ) end, { }, "UPDATE nrp_players SET permanent_data=? WHERE id=? LIMIT 1", permanent_data, id )
                    end,
                { data.id, data.nickname, permanent_data.unlocked_animations }, "SELECT permanent_data FROM nrp_players WHERE id=? LIMIT 1", id 
            )
            end
        end

        iprint( "Players with animations:", n )
    end,
    { }, "SELECT id, nickname, client_id, permanent_data FROM nrp_players WHERE permanent_data IS NOT NULL"
)

setTimer( function( )
    local total_tbl = { }

    for i, v in pairs( RESTORED_ANIMATIONS ) do
        local nick = NICKNAMES[ i ]
        local animations_list = table.concat( v, ";" )
        local str = table.concat( { nick, animations_list }, ";" )
        table.insert( total_tbl, str )
    end

    local total_str = table.concat( total_tbl, "\n" )

    local file = fileCreate( "restored_animations_" .. getRealTime( ).timestamp .. ".csv" )
    fileWrite( file, total_str )
    fileClose( file )

    iprint( "Restore animations file written" )
end, 45000, 1 )